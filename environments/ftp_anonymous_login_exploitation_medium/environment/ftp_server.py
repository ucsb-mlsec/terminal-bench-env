#!/usr/bin/env python3

import os
from pyftpdlib.authorizers import DummyAuthorizer
from pyftpdlib.handlers import FTPHandler
from pyftpdlib.servers import FTPServer

def main():
    # Create ftp_root directory if it doesn't exist
    script_dir = os.path.dirname(os.path.abspath(__file__))
    ftp_root = os.path.join(script_dir, 'ftp_root')
    
    if not os.path.exists(ftp_root):
        os.makedirs(ftp_root)
    
    # Set up authorizer with anonymous access
    authorizer = DummyAuthorizer()
    authorizer.add_anonymous(ftp_root, perm='elr')
    
    # Set up handler
    handler = FTPHandler
    handler.authorizer = authorizer
    
    # Set up server
    server = FTPServer(('127.0.0.1', 2121), handler)
    
    print(f"FTP Server starting on 127.0.0.1:2121")
    print(f"Serving files from: {ftp_root}")
    print("Anonymous access enabled")
    
    # Start server
    server.serve_forever()

if __name__ == '__main__':
    main()