# Mosquitto MQTT Broker Configuration
# QoS Support Configuration for IoT Sensor Network

# Network listener configuration
listener 1883
protocol mqtt

# Authentication settings
allow_anonymous true

# QoS Message Queue Configuration
# ISSUE: max_queued_messages set too low for production workload
# This causes message loss when clients are temporarily disconnected
# For QoS 1 and QoS 2 messages to be properly queued during client disconnections,
# this value must be increased significantly
max_queued_messages 1000

# Message persistence configuration
# CRITICAL: Required for QoS 1 and QoS 2 message delivery guarantees
# Without persistence, messages may be lost during broker restart
persistence true
persistence_location /var/lib/mosquitto/

# Logging configuration
log_dest stdout
log_type all

# In-flight message limits
# Controls how many QoS 1 and QoS 2 messages can be in transmission simultaneously
# Default of 20 is reasonable for most deployments
max_inflight_messages 20

# Maximum QoS level supported by broker
# CORRECT: Set to 2 to support exactly-once delivery for critical alerts
# This allows clients to use QoS 0, 1, or 2 as needed
max_qos_allowed 2

# QoS Level Guidelines:
# QoS 0 (At most once): Fire and forget, no acknowledgment, minimal overhead
#   - Use for: Diagnostic data, heartbeats, non-critical telemetry
#   - Pros: Lowest bandwidth, no broker storage required
#   - Cons: Messages may be lost
#
# QoS 1 (At least once): Message delivered with acknowledgment, may duplicate
#   - Use for: Important telemetry, sensor readings, monitoring data
#   - Pros: Guarantees delivery, reasonable overhead
#   - Cons: May receive duplicates
#
# QoS 2 (Exactly once): Four-way handshake ensures single delivery
#   - Use for: Critical alerts, commands, billing data, fire safety
#   - Pros: Guarantees exactly one delivery, no duplicates
#   - Cons: Highest overhead, requires message ID tracking

# Session and message retention
# Clean session false with QoS 1/2 ensures messages are queued for offline clients
# Message expiry intervals should be configured per-client based on requirements