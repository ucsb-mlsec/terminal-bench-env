#!/bin/bash

# Create temporary directory for building the archive
TMP_DIR=$(mktemp -d)
cd "$TMP_DIR"

# Create the deeply nested directory structure with long paths
mkdir -p "project/src/components/administration/user_management/profile_settings/personal_information/contact_details/emergency_contacts/relatives/primary"
mkdir -p "project/src/components/administration/user_management/profile_settings/personal_information/address_information/billing_addresses/international"
mkdir -p "project/documentation/technical/architecture/microservices/authentication_service/implementation_guides/security_protocols"
mkdir -p "project/src/components/customer_relationship/management_system/data_processing/analytics_engine/report_generation/templates"
mkdir -p "project/tests/integration/end_to_end/user_interface/component_testing/form_validation/input_fields"
mkdir -p "project/configuration/environment/production/database/connection_pooling/performance_optimization"
mkdir -p "project/src/utilities/helper_functions/string_manipulation/text_processing/natural_language"

# Create files with realistic content in the deeply nested paths
cat > "project/src/components/administration/user_management/profile_settings/personal_information/contact_details/emergency_contacts/relatives/primary/contact_manager.py" << 'EOF'
def get_primary_contact():
    return {"name": "Emergency Contact", "phone": "555-0100"}

def update_contact(contact_id, data):
    print(f"Updating contact {contact_id}")
    return True
EOF

cat > "project/src/components/administration/user_management/profile_settings/personal_information/address_information/billing_addresses/international/address_validator.py" << 'EOF'
import re

def validate_international_address(address):
    if not address or len(address) < 10:
        return False
    return True

def format_address(country, street, city, postal):
    return f"{street}, {city}, {postal}, {country}"
EOF

cat > "project/documentation/technical/architecture/microservices/authentication_service/implementation_guides/security_protocols/oauth_implementation.md" << 'EOF'
# OAuth 2.0 Implementation Guide

## Overview
This document describes the OAuth 2.0 implementation for the authentication service.

## Configuration
- Client ID: Configure in environment variables
- Secret: Store in secure vault
- Redirect URIs: Must be whitelisted
EOF

cat > "project/src/components/customer_relationship/management_system/data_processing/analytics_engine/report_generation/templates/monthly_report.json" << 'EOF'
{
  "report_type": "monthly",
  "sections": ["summary", "details", "analytics"],
  "format": "pdf",
  "recipients": ["management@example.com"]
}
EOF

cat > "project/tests/integration/end_to_end/user_interface/component_testing/form_validation/input_fields/email_validator_test.py" << 'EOF'
import unittest

class EmailValidatorTest(unittest.TestCase):
    def test_valid_email(self):
        self.assertTrue(validate_email("user@example.com"))
    
    def test_invalid_email(self):
        self.assertFalse(validate_email("invalid"))
EOF

cat > "project/configuration/environment/production/database/connection_pooling/performance_optimization/pool_settings.json" << 'EOF'
{
  "max_connections": 100,
  "min_connections": 10,
  "timeout": 30000,
  "idle_timeout": 600000
}
EOF

cat > "project/src/utilities/helper_functions/string_manipulation/text_processing/natural_language/text_analyzer.py" << 'EOF'
def analyze_text(text):
    words = text.split()
    return {
        "word_count": len(words),
        "char_count": len(text),
        "avg_word_length": sum(len(w) for w in words) / len(words) if words else 0
    }
EOF

# Create additional files with shorter paths for variety
mkdir -p "project/src/main"
cat > "project/src/main/application.py" << 'EOF'
#!/usr/bin/env python3

def main():
    print("Application starting...")
    
if __name__ == "__main__":
    main()
EOF

cat > "project/README.md" << 'EOF'
# Project Documentation

This is a sample project with deeply nested directory structures.
EOF

mkdir -p "project/data"
cat > "project/data/config.json" << 'EOF'
{
  "version": "1.0.0",
  "name": "sample-project"
}
EOF

# Create more files in deep paths
cat > "project/src/components/administration/user_management/profile_settings/personal_information/contact_details/emergency_contacts/contact_list.txt" << 'EOF'
Emergency Contacts List
======================
1. Primary Contact
2. Secondary Contact
3. Tertiary Contact
EOF

cat > "project/src/components/administration/user_management/profile_settings/personal_information/address_information/billing_addresses/address_book.txt" << 'EOF'
Address Book
============
Billing Addresses
Shipping Addresses
EOF

cat > "project/documentation/technical/architecture/microservices/authentication_service/implementation_guides/setup_guide.md" << 'EOF'
# Setup Guide

## Prerequisites
- Python 3.8+
- PostgreSQL 12+

## Installation
Run `pip install -r requirements.txt`
EOF

cat > "project/tests/integration/end_to_end/user_interface/component_testing/form_validation/validation_rules.json" << 'EOF'
{
  "email": {"required": true, "pattern": "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"},
  "phone": {"required": false, "min_length": 10}
}
EOF

cat > "project/configuration/environment/production/database/connection_pooling/database_config.txt" << 'EOF'
Database Configuration
=====================
Host: localhost
Port: 5432
Database: production_db
EOF

cat > "project/src/utilities/helper_functions/string_manipulation/text_processing/string_utils.py" << 'EOF'
def truncate_string(s, length=50):
    return s[:length] + "..." if len(s) > length else s

def capitalize_words(s):
    return " ".join(word.capitalize() for word in s.split())
EOF

mkdir -p "project/src/models"
cat > "project/src/models/user.py" << 'EOF'
class User:
    def __init__(self, username, email):
        self.username = username
        self.email = email
EOF

cat > "project/src/components/customer_relationship/management_system/data_processing/analytics_engine/report_generation/report_generator.py" << 'EOF'
def generate_report(data, template):
    print(f"Generating report with template: {template}")
    return {"status": "success", "report_id": 12345}
EOF

cat > "project/tests/integration/end_to_end/user_interface/component_testing/test_suite.py" << 'EOF'
import unittest

def run_tests():
    loader = unittest.TestLoader()
    suite = loader.discover('.')
    runner = unittest.TextTestRunner()
    runner.run(suite)
EOF

cat > "project/configuration/environment/production/app_config.json" << 'EOF'
{
  "environment": "production",
  "debug": false,
  "log_level": "INFO"
}
EOF

# Create the tar archive using GNU format to support long paths
tar --format=gnu -cf /home/user/backup.tar project/

# Clean up
cd /
rm -rf "$TMP_DIR"

echo "Archive created at /home/user/backup.tar"