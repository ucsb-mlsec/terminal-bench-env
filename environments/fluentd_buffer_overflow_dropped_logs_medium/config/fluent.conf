<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

<source>
  @type tail
  path /var/log/app/*.log
  pos_file /var/log/fluentd/app.pos
  tag app.logs
  <parse>
    @type json
  </parse>
</source>

<source>
  @type http
  port 9880
  bind 0.0.0.0
</source>

<match app.**>
  @type elasticsearch
  host elasticsearch.local
  port 9200
  logstash_format true
  logstash_prefix app-logs
  <buffer>
    @type file
    path /var/log/fluentd/buffer/app
    chunk_limit_size 1m
    queue_limit_length 8
    flush_interval 5s
    flush_thread_count 1
  </buffer>
</match>

<match system.**>
  @type file
  path /var/log/output/system.log
  append true
  <buffer>
    @type memory
    chunk_limit_size 2m
    queue_limit_length 4
    flush_interval 10s
  </buffer>
</match>

<match audit.**>
  @type s3
  s3_bucket audit-logs-bucket
  s3_region us-east-1
  path logs/
  time_slice_format %Y%m%d%H
  <buffer>
    @type file
    path /var/log/fluentd/buffer/audit
    chunk_limit_size 1m
    total_limit_size 16m
    queue_limit_length 8
    flush_interval 60s
  </buffer>
</match>

<match **>
  @type stdout
</match>