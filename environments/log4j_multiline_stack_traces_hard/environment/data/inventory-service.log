[2024-01-15 08:15:23.445] [inventory-sync-1] INFO  com.inventory.service.InventoryService - Starting inventory synchronization for warehouse W-001
[2024-01-15 08:15:23.678] [inventory-sync-1] DEBUG com.inventory.service.InventoryService - Loading 2345 SKUs from database
[2024-01-15 08:15:24.123] [http-nio-9090-exec-3] INFO  com.inventory.api.InventoryController - Processing reservation request for SKU: ITEM-5678, quantity: 15
[2024-01-15 08:15:24.234] [http-nio-9090-exec-3] ERROR com.inventory.service.StockManager - Failed to update stock for SKU: ITEM-5678
java.lang.IllegalStateException: Inventory state is inconsistent
	at com.inventory.StockManager.updateStock(StockManager.java:234)
	at com.inventory.InventoryService.reserve(InventoryService.java:145)
	at com.inventory.api.InventoryController.handleReservation(InventoryController.java:67)
	at com.inventory.api.InventoryController.processReservation(InventoryController.java:42)
	at jdk.internal.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:190)
Caused by: java.sql.SQLException: Deadlock detected
	at com.inventory.db.InventoryDAO.update(InventoryDAO.java:189)
	at com.inventory.db.TransactionManager.executeUpdate(TransactionManager.java:56)
	at com.inventory.StockManager.updateStock(StockManager.java:230)
	... 5 more
[2024-01-15 08:15:24.567] [inventory-sync-1] DEBUG com.inventory.service.InventoryService - Processing SKU batch 1/23
[2024-01-15 08:15:25.890] [scheduler-1] INFO  com.inventory.task.StockRefreshTask - Executing scheduled stock refresh
[2024-01-15 08:15:26.123] [http-nio-9090-exec-5] WARN  com.inventory.service.StockValidator - Low stock detected for SKU: ITEM-1234, current: 5, threshold: 10
[2024-01-15 08:15:26.345] [http-nio-9090-exec-7] INFO  com.inventory.api.InventoryController - Checking availability for SKU: ITEM-9012
[2024-01-15 08:15:26.456] [http-nio-9090-exec-7] ERROR com.inventory.service.InventoryService - Stock check failed
com.inventory.OutOfStockException: Product ITEM-9012 is out of stock
	at com.inventory.service.StockValidator.validateAvailability(StockValidator.java:78)
	at com.inventory.InventoryService.checkStock(InventoryService.java:203)
	at com.inventory.api.InventoryController.getAvailability(InventoryController.java:89)
	at jdk.internal.reflect.GeneratedMethodAccessor92.invoke(Unknown Source)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:190)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)
[2024-01-15 08:15:27.234] [inventory-sync-1] TRACE com.inventory.service.InventoryService - Synchronized SKU: ITEM-3456, warehouse stock: 150
[2024-01-15 08:15:27.567] [inventory-sync-1] TRACE com.inventory.service.InventoryService - Synchronized SKU: ITEM-3457, warehouse stock: 75
[2024-01-15 09:23:45.123] [http-nio-9090-exec-11] INFO  com.inventory.api.InventoryController - Bulk reservation request received for 25 items
[2024-01-15 09:23:45.456] [http-nio-9090-exec-11] DEBUG com.inventory.service.ReservationService - Starting bulk reservation transaction
[2024-01-15 09:23:45.789] [http-nio-9090-exec-11] ERROR com.inventory.db.InventoryDAO - Database connection failed
java.sql.SQLException: Connection pool exhausted
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:190)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:162)
	at com.inventory.db.ConnectionManager.getConnection(ConnectionManager.java:45)
	at com.inventory.db.InventoryDAO.executeQuery(InventoryDAO.java:234)
	at com.inventory.db.InventoryDAO.findBySku(InventoryDAO.java:156)
	at com.inventory.service.ReservationService.reserveMultiple(ReservationService.java:98)
	at com.inventory.api.InventoryController.bulkReserve(InventoryController.java:123)
	at jdk.internal.reflect.GeneratedMethodAccessor94.invoke(Unknown Source)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
[2024-01-15 09:23:46.234] [http-nio-9090-exec-12] INFO  com.inventory.api.InventoryController - Processing reservation request for SKU: ITEM-7890, quantity: 8
[2024-01-15 09:23:46.567] [scheduler-1] DEBUG com.inventory.task.StockRefreshTask - Refreshing stock data from external warehouse system
[2024-01-15 10:45:12.345] [inventory-sync-2] INFO  com.inventory.service.InventoryService - Starting inventory synchronization for warehouse W-002
[2024-01-15 10:45:12.678] [inventory-sync-2] DEBUG com.inventory.service.InventoryService - Loading 1876 SKUs from database
[2024-01-15 10:45:13.456] [http-nio-9090-exec-15] ERROR com.inventory.service.StockManager - Critical error during stock update
java.lang.IllegalStateException: Inventory state is inconsistent
	at com.inventory.StockManager.updateStock(StockManager.java:234)
	at com.inventory.InventoryService.adjustStock(InventoryService.java:178)
	at com.inventory.service.AdjustmentService.processAdjustment(AdjustmentService.java:89)
	at com.inventory.api.InventoryController.handleAdjustment(InventoryController.java:156)
	at jdk.internal.reflect.GeneratedMethodAccessor95.invoke(Unknown Source)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:190)
[2024-01-15 10:45:14.123] [inventory-sync-2] TRACE com.inventory.service.InventoryService - Synchronized SKU: ITEM-4567, warehouse stock: 230
[2024-01-15 10:45:14.456] [http-nio-9090-exec-16] WARN  com.inventory.service.StockValidator - Stock level critical for SKU: ITEM-2345, current: 2, threshold: 10
[2024-01-15 11:12:34.567] [http-nio-9090-exec-18] INFO  com.inventory.api.InventoryController - Reservation rollback initiated for order: ORD-12345
[2024-01-15 11:12:34.890] [http-nio-9090-exec-18] DEBUG com.inventory.service.ReservationService - Rolling back reservation for 12 items
[2024-01-15 11:12:35.123] [http-nio-9090-exec-18] ERROR com.inventory.service.ReservationService - Rollback failed
java.lang.IllegalStateException: Cannot rollback - reservation not found
	at com.inventory.service.ReservationService.validateRollback(ReservationService.java:234)
	at com.inventory.service.ReservationService.rollback(ReservationService.java:201)
	at com.inventory.api.InventoryController.cancelReservation(InventoryController.java:178)
	at jdk.internal.reflect.GeneratedMethodAccessor97.invoke(Unknown Source)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:190)
[2024-01-15 11:12:35.456] [scheduler-1] INFO  com.inventory.task.CleanupTask - Running expired reservation cleanup
[2024-01-15 11:12:35.789] [scheduler-1] DEBUG com.inventory.task.CleanupTask - Found 23 expired reservations
[2024-01-15 12:34:56.123] [http-nio-9090-exec-22] INFO  com.inventory.api.InventoryController - Processing warehouse transfer request
[2024-01-15 12:34:56.456] [http-nio-9090-exec-22] DEBUG com.inventory.service.TransferService - Transfer from W-001 to W-002, SKU: ITEM-6789, quantity: 50
[2024-01-15 12:34:56.789] [http-nio-9090-exec-22] ERROR com.inventory.service.TransferService - Transfer validation failed
java.lang.NullPointerException: Source warehouse stock record is null
	at com.inventory.service.TransferService.validateTransfer(TransferService.java:145)
	at com.inventory.service.TransferService.initiateTransfer(TransferService.java:98)
	at com.inventory.api.InventoryController.processTransfer(InventoryController.java:234)
	at jdk.internal.reflect.GeneratedMethodAccessor99.invoke(Unknown Source)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:190)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)
[2024-01-15 12:34:57.123] [inventory-sync-2] TRACE com.inventory.service.InventoryService - Synchronized SKU: ITEM-5678, warehouse stock: 89
[2024-01-15 12:34:57.456] [inventory-sync-2] INFO  com.inventory.service.InventoryService - Synchronization completed for warehouse W-002, processed 1876 SKUs
[2024-01-15 13:45:23.234] [http-nio-9090-exec-25] INFO  com.inventory.api.InventoryController - Stock inquiry for multiple SKUs
[2024-01-15 13:45:23.567] [http-nio-9090-exec-25] DEBUG com.inventory.service.InventoryService - Querying stock for 45 SKUs
[2024-01-15 13:45:23.890] [http-nio-9090-exec-25] ERROR com.inventory.db.InventoryDAO - Query execution failed
java.sql.SQLException: Statement timeout exceeded
	at org.postgresql.jdbc.PgStatement.executeQuery(PgStatement.java:234)
	at com.zaxxer.hikari.pool.ProxyStatement.executeQuery(ProxyStatement.java:112)
	at com.inventory.db.InventoryDAO.executeQuery(InventoryDAO.java:267)
	at com.inventory.db.InventoryDAO.findMultipleBySku(InventoryDAO.java:198)
	at com.inventory.service.InventoryService.getStockLevels(InventoryService.java:289)
	at com.inventory.api.InventoryController.bulkInquiry(InventoryController.java:267)
	at jdk.internal.reflect.GeneratedMethodAccessor101.invoke(Unknown Source)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
[2024-01-15 13:45:24.234] [scheduler-1] INFO  com.inventory.task.StockRefreshTask - Scheduled refresh completed successfully
[2024-01-15 14:23:45.567] [http-nio-9090-exec-28] INFO  com.inventory.api.InventoryController - Processing reservation for SKU: ITEM-3333, quantity: 20
[2024-01-15 14:23:45.890] [http-nio-9090-exec-28] ERROR com.inventory.service.InventoryService - Reservation failed - insufficient stock
com.inventory.OutOfStockException: Insufficient stock for SKU: ITEM-3333, requested: 20, available: 12
	at com.inventory.service.StockValidator.validateAvailability(StockValidator.java:78)
	at com.inventory.InventoryService.reserve(InventoryService.java:145)
	at com.inventory.api.InventoryController.handleReservation(InventoryController.java:67)
	at com.inventory.api.InventoryController.processReservation(InventoryController.java:42)
	at jdk.internal.reflect.GeneratedMethodAccessor102.invoke(Unknown Source)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:190)
[2024-01-15 14:23:46.234] [inventory-sync-3] INFO  com.inventory.service.InventoryService - Starting inventory synchronization for warehouse W-003
[2024-01-15 14:23:46.567] [inventory-sync-3] DEBUG com.inventory.service.InventoryService - Loading 3124 SKUs from database
[2024-01-15 15:34:12.345] [http-nio-9090-exec-31] INFO  com.inventory.api.InventoryController - Batch update request received
[2024-01-15 15:34:12.678] [http-nio-9090-exec-31] DEBUG com.inventory.service.BatchUpdateService - Processing batch update for 78 items
[2024-01-15 15:34:13.012] [http-nio-9090-exec-31] ERROR com.inventory.service.BatchUpdateService - Concurrent modification detected
java.util.ConcurrentModificationException: Stock record modified by another transaction
	at com.inventory.service.BatchUpdateService.validateBatch(BatchUpdateService.java:167)
	at com.inventory.service.BatchUpdateService.processBatch(BatchUpdateService.java:123)
	at com.inventory.api.InventoryController.batchUpdate(InventoryController.java:301)
	at jdk.internal.reflect.GeneratedMethodAccessor104.invoke(Unknown Source)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:190)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:105)
[2024-01-15 15:34:13.345] [inventory-sync-3] TRACE com.inventory.service.InventoryService - Synchronized SKU: ITEM-6789, warehouse stock: 445
[2024-01-15 15:34:13.678] [http-nio-9090-exec-32] WARN  com.inventory.service.StockValidator - Multiple low stock items detected in current batch
[2024-01-15 16:12:34.456] [http-nio-9090-exec-35] INFO  com.inventory.api.InventoryController - Reservation request for SKU: ITEM-8888, quantity: 5
[2024-01-15 16:12:34.789] [http-nio-9090-exec-35] ERROR com.inventory.service.StockManager - Stock update failed with database constraint violation
java.lang.IllegalStateException: Inventory state is inconsistent
	at com.inventory.StockManager.updateStock(StockManager.java:234)
	at com.inventory.InventoryService.reserve(InventoryService.java:145)
	at com.inventory.api.InventoryController.handleReservation(InventoryController.java:67)
	at com.inventory.api.InventoryController.processReservation(InventoryController.java:42)
	at jdk.internal.reflect.GeneratedMethodAccessor106.invoke(Unknown Source)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:190)
Caused by: java.sql.SQLException: Check constraint violation
	at org.postgresql.jdbc.PgStatement.executeUpdate(PgStatement.java:178)
	at com.inventory.db.InventoryDAO.update(InventoryDAO.java:189)
	at com.inventory.db.TransactionManager.executeUpdate(TransactionManager.java:56)
	... 7 more
[2024-01-15 16:12:35.123] [scheduler-1] INFO  com.inventory.task.StockRefreshTask - Executing scheduled stock refresh
[2024-01-15 16:12:35.456] [inventory-sync-3] DEBUG com.inventory.service.InventoryService - Synchronization progress: 2500/3124 SKUs processed
[2024-01-15 17:23:45.234] [http-nio-9090-exec-38] INFO  com.inventory.api.InventoryController - Checking stock for SKU: ITEM-7777
[2024-01-15 17:23:45.567] [http-nio-9090-exec-38] ERROR com.inventory.service.InventoryService - Null pointer encountered during stock check
java.lang.NullPointerException: Stock record cache returned null
	at com.inventory.cache.StockCache.get(StockCache.java:89)
	at com.inventory.service.InventoryService.checkStock(InventoryService.java:203)
	at com.inventory.api.InventoryController.getAvailability(InventoryController.java:89)
	at jdk.internal.reflect.GeneratedMethodAccessor108.invoke(Unknown Source)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:190)
[2024-01-15 17:23:45.890] [inventory-sync-3] TRACE com.inventory.service.InventoryService - Synchronized SKU: ITEM-8901, warehouse stock: 312
[2024-01-15 17:23:46.234] [inventory-sync-3] INFO  com.inventory.service.InventoryService - Synchronization completed for warehouse W-003, processed 3124 SKUs
[2024-01-15 17:23:46.567] [scheduler-1] DEBUG com.inventory.task.CleanupTask - Cleanup task completed, removed 15 expired reservations