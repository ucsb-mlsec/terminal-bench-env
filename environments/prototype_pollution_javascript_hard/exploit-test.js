const merge = require('./merge-utils.js');

console.log('=== PROTOTYPE POLLUTION EXPLOIT TEST ===\n');

// Check if prototype is clean before exploit
const testObj1 = {};
console.log('BEFORE EXPLOIT:', testObj1.isHacked);

// Create malicious payload using __proto__
const maliciousPayload = JSON.parse('{"__proto__": {"isHacked": "hacked"}}');

// Attempt to merge with a target object
const target = { normalProperty: 'value' };
merge(target, maliciousPayload);

// Check if prototype was polluted
const testObj2 = {};
console.log('AFTER EXPLOIT:', testObj2.isHacked);

// Verify exploit result
if (testObj2.isHacked === 'hacked') {
    console.log('\n❌ EXPLOIT SUCCESSFUL - Prototype was polluted!');
} else {
    console.log('\n✓ EXPLOIT FAILED - Prototype was NOT polluted!');
}