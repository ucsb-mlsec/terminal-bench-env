2024-01-15T14:23:11.234567Z 0 [Note] InnoDB: Starting shutdown...
2024-01-15T14:23:12.345678Z 0 [Note] InnoDB: Shutdown completed; log sequence number 12345678
2024-01-15T14:23:12.456789Z 0 [Note] InnoDB: Starting recovery for XA transactions...
2024-01-15T14:23:12.567890Z 0 [Note] InnoDB: Transaction 421847239822 was in the XA prepared state.
2024-01-15T14:23:45.123456Z 0 [Warning] InnoDB: Difficult to find free blocks in the buffer pool (1000 search iterations)!
2024-01-15T15:47:23.891234Z 0 [ERROR] InnoDB: Cannot allocate memory for the buffer pool
------------------------
LATEST DETECTED DEADLOCK
------------------------
2024-01-15 16:32:18 0x7f8c4c0b9700
*** (1) TRANSACTION:
TRANSACTION 421847239847, ACTIVE 12 sec starting index read
mysql tables in use 1, locked 1
LOCK WAIT 3 lock struct(s), heap size 1136, 2 row lock(s), undo log entries 1
MySQL thread id 8721, OS thread handle 140238564632320, query id 15234 localhost appuser updating
UPDATE inventory SET quantity = quantity - 5 WHERE product_id = 1001 AND warehouse_id = 3
*** (1) WAITING FOR THIS LOCK TO BE GRANTED:
RECORD LOCKS space id 127 page no 845 n bits 248 index PRIMARY of table `production_db`.`inventory` trx id 421847239847 lock_mode X locks rec but not gap waiting
Record lock, heap no 87 PHYSICAL RECORD: n_fields 8; compact format; info bits 0
 0: len 4; hex 800003e9; asc     ;;
 1: len 4; hex 80000003; asc     ;;
 2: len 6; hex 000061f2b3c7; asc   a   ;;
 3: len 7; hex 81000001340110; asc     4  ;;
 4: len 4; hex 80000032; asc    2;;

*** (2) TRANSACTION:
TRANSACTION 421847239851, ACTIVE 8 sec starting index read
mysql tables in use 1, locked 1
4 lock struct(s), heap size 1136, 3 row lock(s), undo log entries 2
MySQL thread id 8734, OS thread handle 140238565698304, query id 15289 localhost appuser updating
UPDATE orders SET status = 'processing', updated_at = NOW() WHERE order_id = 5047 AND customer_id = 2301
*** (2) HOLDS THE LOCK(S):
RECORD LOCKS space id 127 page no 845 n bits 248 index PRIMARY of table `production_db`.`inventory` trx id 421847239851 lock_mode X locks rec but not gap
Record lock, heap no 87 PHYSICAL RECORD: n_fields 8; compact format; info bits 0
 0: len 4; hex 800003e9; asc     ;;
 1: len 4; hex 80000003; asc     ;;
 2: len 6; hex 000061f2b3c7; asc   a   ;;

*** (2) WAITING FOR THIS LOCK TO BE GRANTED:
RECORD LOCKS space id 126 page no 423 n bits 312 index PRIMARY of table `production_db`.`orders` trx id 421847239851 lock_mode X locks rec but not gap waiting
Record lock, heap no 145 PHYSICAL RECORD: n_fields 12; compact format; info bits 0
 0: len 4; hex 800013b7; asc     ;;
 1: len 4; hex 800008fd; asc     ;;
 2: len 6; hex 000061f2b3c3; asc   a   ;;
 3: len 7; hex 82000001450210; asc     E  ;;

*** WE ROLL BACK TRANSACTION (1)
2024-01-15T16:32:18.891567Z 8721 [Note] InnoDB: Rolled back transaction 421847239847
2024-01-15T16:32:18.891789Z 0 [Note] InnoDB: Deadlock found when trying to get lock; try restarting transaction
2024-01-15T16:45:12.234567Z 0 [Warning] InnoDB: A long semaphore wait
2024-01-15T16:45:12.345678Z 0 [Note] InnoDB: MySQL thread id 8745 has waited at row0sel.cc line 1234 for 241.00 seconds