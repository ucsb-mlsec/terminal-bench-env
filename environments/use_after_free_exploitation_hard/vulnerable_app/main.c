#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// User structure for maintaining user information
typedef struct User {
    char name[50];
    int id;
    struct User* next;
} User;

// Global pointer to the head of the user linked list
static User* head = NULL;

// Function to add a new user to the linked list
// Allocates memory for a new user and adds it to the front of the list
void add_user(const char* name, int id) {
    User* new_user = (User*)malloc(sizeof(User));
    if (new_user == NULL) {
        printf("Memory allocation failed\n");
        return;
    }
    
    strncpy(new_user->name, name, sizeof(new_user->name) - 1);
    new_user->name[sizeof(new_user->name) - 1] = '\0';
    new_user->id = id;
    new_user->next = head;
    head = new_user;
    
    printf("User '%s' (ID: %d) added successfully\n", name, id);
}

// Function to remove a user from the linked list by ID
// Frees the memory associated with the removed user
void remove_user(int id) {
    User* current = head;
    User* previous = NULL;
    
    while (current != NULL) {
        if (current->id == id) {
            if (previous == NULL) {
                head = current->next;
            } else {
                previous->next = current->next;
            }
            
            printf("User '%s' (ID: %d) removed successfully\n", current->name, current->id);
            free(current);
            return;
        }
        previous = current;
        current = current->next;
    }
    
    printf("User with ID %d not found\n", id);
}

// Function to find and return a user by ID
// Returns pointer to the user if found, NULL otherwise
User* find_user(int id) {
    User* current = head;
    
    while (current != NULL) {
        if (current->id == id) {
            return current;
        }
        current = current->next;
    }
    
    return NULL;
}

// Function to display information about a specific user
// Takes a pointer to a User structure and prints its details
void display_user(User* user) {
    if (user != NULL) {
        printf("User Information:\n");
        printf("  Name: %s\n", user->name);
        printf("  ID: %d\n", user->id);
    } else {
        printf("User not found\n");
    }
}

// Function to display all users in the linked list
void display_all_users() {
    User* current = head;
    
    if (current == NULL) {
        printf("No users in the system\n");
        return;
    }
    
    printf("All Users:\n");
    while (current != NULL) {
        printf("  Name: %s, ID: %d\n", current->name, current->id);
        current = current->next;
    }
}

// Function to process a user removal and display operation
// This function removes a user and then attempts to display their information
void process_user_removal(int id) {
    User* user = find_user(id);
    
    if (user == NULL) {
        printf("Cannot process removal - user not found\n");
        return;
    }
    
    remove_user(id);
    
    printf("Displaying removed user information:\n");
    display_user(user);
}

// Function to cleanup all allocated memory
void cleanup() {
    User* current = head;
    User* next;
    
    while (current != NULL) {
        next = current->next;
        free(current);
        current = next;
    }
    
    head = NULL;
    printf("All users cleaned up\n");
}

int main() {
    printf("User Management System\n");
    printf("======================\n\n");
    
    // Add some users
    add_user("Alice Smith", 1001);
    add_user("Bob Johnson", 1002);
    add_user("Charlie Brown", 1003);
    
    printf("\n");
    display_all_users();
    
    printf("\n--- Processing user removal ---\n");
    process_user_removal(1002);
    
    printf("\n");
    display_all_users();
    
    printf("\n");
    cleanup();
    
    return 0;
}