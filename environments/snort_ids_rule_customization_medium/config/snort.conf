# Snort Configuration File for Custom Web Application IDS
# Environment: 192.168.100.0/24 network with web server on port 8080
# Purpose: Minimizing false positives while detecting specific attack vectors

# ==================================================
# Network Variables Section
# ==================================================

# Define the internal network
var HOME_NET 192.168.100.0/24

# Define external network (any source outside internal network)
var EXTERNAL_NET any

# HTTP servers are within our internal network
var HTTP_SERVERS 192.168.100.0/24

# Custom HTTP port for our web application
var HTTP_PORTS 8080

# SQL servers location
var SQL_SERVERS 192.168.100.0/24

# ==================================================
# Paths Configuration
# ==================================================

var RULE_PATH /opt/snort/rules
var SO_RULE_PATH /opt/snort/so_rules
var PREPROC_RULE_PATH /opt/snort/preproc_rules

# ==================================================
# Decoder and Preprocessor Configuration
# ==================================================

# Configure logging directory
config logdir: /var/log/snort

# Detection engine optimization
config detection: search-method ac-split search-optimize max-pattern-len 20

# Configure packet decoding
config disable_decode_alerts
config disable_tcpopt_experimental_alerts
config disable_tcpopt_obsolete_alerts
config disable_tcpopt_ttcp_alerts
config disable_tcpopt_alerts
config disable_ipopt_alerts

# Configure event queue to handle multiple events per packet
config event_queue: max_queue 8 log 3 order_events content_length

# Configure checksum verification
config checksum_mode: all

# ==================================================
# HTTP Inspection Preprocessor
# ==================================================

# HTTP inspection for our custom port 8080
preprocessor http_inspect: global iis_unicode_map unicode.map 1252 compress_depth 65535 decompress_depth 65535

preprocessor http_inspect_server: server default \
    profile all \
    ports { 8080 } \
    server_flow_depth 0 \
    client_flow_depth 0 \
    post_depth 65495 \
    oversize_dir_length 500 \
    max_header_length 750 \
    max_headers 100 \
    max_spaces 200 \
    normalize_utf \
    normalize_javascript \
    enable_cookie \
    extended_response_inspection \
    inspect_gzip \
    unlimited_decompress

# Stream5 preprocessor for TCP session tracking
preprocessor stream5_global: track_tcp yes, track_udp yes, track_icmp no, max_tcp 262144, max_udp 131072
preprocessor stream5_tcp: policy windows, detect_anomalies, require_3whs 180, overlap_limit 10, small_segments 3 bytes 150, timeout 180

# ==================================================
# Output Plugins Configuration
# ==================================================

# Fast alert output for security analysts
output alert_fast: alerts.txt

# Full packet logging in tcpdump format
output log_tcpdump: tcpdump.log

# Unified2 output for external tools integration
output unified2: filename snort.u2, limit 128

# ==================================================
# Custom Rules Configuration
# ==================================================

# Note: Default Snort community rules were generating excessive false positives
# for our specific web application environment, particularly from:
# - Legitimate monitoring tools (Nagios, Prometheus exporters)
# - Internal security scanners performing authorized assessments
# - Development team API testing frameworks
#
# Custom rules have been created to address specific attack vectors
# while minimizing false positive alerts in our production environment

# Include custom detection rules for our application
include /opt/snort/rules/custom.rules

# Include local rules for environment-specific detections
include /opt/snort/rules/local.rules

# ==================================================
# Classification and Priority Definitions
# ==================================================

# Classification types for alert categorization
config classification: web-application-attack,Web Application Attack,1
config classification: attempted-admin,Attempted Administrator Privilege Gain,1
config classification: successful-admin,Successful Administrator Privilege Gain,1
config classification: attempted-user,Attempted User Privilege Gain,1
config classification: suspicious-filename-detect,Suspicious Filename Detection,2
config classification: policy-violation,Potential Corporate Privacy Violation,1
config classification: shellcode-detect,Executable Code Detection,1
config classification: suspicious-login,Suspicious Login Attempt,2

# ==================================================
# Reference Systems
# ==================================================

config reference: bugtraq http://www.securityfocus.com/bid/
config reference: cve http://cve.mitre.org/cgi-bin/cvename.cgi?name=
config reference: nessus http://cgi.nessus.org/plugins/dump.php3?id=

# ==================================================
# End of Configuration
# ==================================================