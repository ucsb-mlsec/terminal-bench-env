#!/bin/bash
#$ -t 1-50
#$ -cwd
#$ -j y
#$ -o /data/logs/
#$ -N genome_processing

# SGE Array Job Script for Processing Genome Sequences
# Fixed version that correctly maps task IDs to sample files
# 
# This script processes 50 genome sequence files named sample_001.fasta through sample_050.fasta
# Each array task processes exactly one file based on its SGE_TASK_ID

# Configuration
FILE_PREFIX="sample_"
FILE_SUFFIX=".fasta"
FILE_DIR="/data/sequences/"
PADDING=3

# Map SGE_TASK_ID (1-50) to filename (sample_001.fasta through sample_050.fasta)
# SGE_TASK_ID ranges from 1 to 50
# File numbers are 001 to 050 (3-digit zero-padded)
# We use printf to format the task ID with leading zeros

FILE_NUMBER=$(printf "%0${PADDING}d" ${SGE_TASK_ID})
INPUT_FILE="${FILE_DIR}${FILE_PREFIX}${FILE_NUMBER}${FILE_SUFFIX}"

# Verify the input file exists before processing
if [ ! -f "${INPUT_FILE}" ]; then
    echo "ERROR: Input file ${INPUT_FILE} does not exist for task ${SGE_TASK_ID}"
    exit 1
fi

echo "Task ${SGE_TASK_ID}: Processing ${INPUT_FILE}"
echo "Started at: $(date)"

# Example processing command - replace with actual bioinformatics pipeline
# This could be alignment, variant calling, quality control, etc.
# For demonstration purposes, showing a placeholder command
# REPLACE THIS with your actual processing tool (e.g., bwa, BLAST, etc.)

# Example: process_genome --input ${INPUT_FILE} --output ${FILE_DIR}/results/${FILE_PREFIX}${FILE_NUMBER}_results.txt

# Placeholder that would be replaced with actual analysis:
echo "Analyzing genome sequence: ${INPUT_FILE}"
# Add your actual bioinformatics tools here

echo "Completed at: $(date)"
echo "Task ${SGE_TASK_ID}: Successfully processed ${INPUT_FILE}"

exit 0