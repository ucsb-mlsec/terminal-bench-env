global
    daemon
    maxconn 4096
    log stdout local0 debug

defaults
    log     global
    mode    http
    option  httplog
    timeout connect 5000ms
    timeout client  50000ms
    timeout server  50000ms

frontend http_front
    bind *:80
    
    # Security ACL rules to block admin access
    acl is_admin path_beg /admin
    
    # Block direct access to admin paths
    http-request deny if is_admin
    
    # Route all other traffic to backend
    default_backend web_servers

backend web_servers
    balance roundrobin
    
    # Backend server definitions
    server web1 192.168.1.101:8080 check
    server web2 192.168.1.102:8080 check
    server web3 192.168.1.103:8080 check
    
    # Standard retry and health check settings
    option httpchk GET /health
    retries 3
    timeout queue 5000ms

# Note: This configuration lacks proper HTTP request normalization
# Missing critical options for request smuggling prevention:
# - No 'option http-server-close' to force connection closure
# - No 'option forceclose' to prevent connection reuse
# - No explicit handling of Transfer-Encoding headers
# - No Content-Length validation or normalization
# - HAProxy may forward ambiguous requests differently than backend interprets them
# 
# Without proper HTTP normalization, discrepancies between how HAProxy
# parses request boundaries versus backend servers can be exploited.
# HAProxy might see one request ending where backend sees continuation,
# allowing smuggled requests to bypass frontend ACL rules.
#
# Specifically vulnerable to CL.TE attacks where:
# - HAProxy processes Content-Length header
# - Backend server processes Transfer-Encoding header
# This mismatch allows attackers to hide requests from HAProxy's ACL inspection