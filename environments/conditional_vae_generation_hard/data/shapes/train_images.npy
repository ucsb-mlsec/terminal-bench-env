import numpy as np
from PIL import Image, ImageDraw

# Create 400 training images (100 per class)
images = np.zeros((400, 28, 28), dtype=np.uint8)

# Helper function to create images using PIL
def create_shape_image(shape_type):
    img = Image.new('L', (28, 28), 0)
    draw = ImageDraw.Draw(img)
    
    if shape_type == 'circle':
        # Filled circle centered at (14, 14) with radius 9
        draw.ellipse([5, 5, 23, 23], fill=255)
    elif shape_type == 'square':
        # Filled square centered at (14, 14) with side 15
        draw.rectangle([7, 7, 22, 22], fill=255)
    elif shape_type == 'triangle':
        # Filled triangle centered
        points = [(14, 6), (24, 22), (4, 22)]
        draw.polygon(points, fill=255)
    elif shape_type == 'cross':
        # Filled cross (plus sign)
        # Vertical bar
        draw.rectangle([12, 4, 16, 24], fill=255)
        # Horizontal bar
        draw.rectangle([4, 12, 24, 16], fill=255)
    
    return np.array(img)

# Generate 100 circles (class 0, indices 0-99)
for i in range(100):
    base_circle = create_shape_image('circle')
    # Add slight variation
    noise = np.random.randint(-20, 21, (28, 28))
    images[i] = np.clip(base_circle.astype(np.int16) + noise * np.random.rand(), 0, 255).astype(np.uint8)
    # Keep it mostly binary
    images[i] = np.where(images[i] > 127, 255, 0)

# Generate 100 squares (class 1, indices 100-199)
for i in range(100, 200):
    base_square = create_shape_image('square')
    noise = np.random.randint(-20, 21, (28, 28))
    images[i] = np.clip(base_square.astype(np.int16) + noise * np.random.rand(), 0, 255).astype(np.uint8)
    images[i] = np.where(images[i] > 127, 255, 0)

# Generate 100 triangles (class 2, indices 200-299)
for i in range(200, 300):
    base_triangle = create_shape_image('triangle')
    noise = np.random.randint(-20, 21, (28, 28))
    images[i] = np.clip(base_triangle.astype(np.int16) + noise * np.random.rand(), 0, 255).astype(np.uint8)
    images[i] = np.where(images[i] > 127, 255, 0)

# Generate 100 crosses (class 3, indices 300-399)
for i in range(300, 400):
    base_cross = create_shape_image('cross')
    noise = np.random.randint(-20, 21, (28, 28))
    images[i] = np.clip(base_cross.astype(np.int16) + noise * np.random.rand(), 0, 255).astype(np.uint8)
    images[i] = np.where(images[i] > 127, 255, 0)

# Save the images
np.save('/data/shapes/train_images.npy', images)