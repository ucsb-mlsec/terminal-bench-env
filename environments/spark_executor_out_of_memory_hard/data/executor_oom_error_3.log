2024-01-15 14:31:45 WARN TaskSetManager: Lost task 127.3 in stage 4.0 (TID 2891, worker-node-05, executor 3): FetchFailed(BlockManagerId(executor 7, worker-node-08, 37842), shuffleId=2, mapId=456, reduceId=127, message=
2024-01-15 14:31:45 ERROR Executor: Exception in task 127.3 in stage 4.0 (TID 2891)
org.apache.spark.shuffle.FetchFailedException: Failed to fetch shuffle blocks from executor 7 on worker-node-08:37842
	at org.apache.spark.storage.ShuffleBlockFetcherIterator.throwFetchFailedException(ShuffleBlockFetcherIterator.scala:748)
	at org.apache.spark.storage.ShuffleBlockFetcherIterator.next(ShuffleBlockFetcherIterator.scala:680)
	at org.apache.spark.storage.ShuffleBlockFetcherIterator.next(ShuffleBlockFetcherIterator.scala:62)
	at scala.collection.Iterator$$anon$11.next(Iterator.scala:410)
	at org.apache.spark.sql.execution.joins.SortMergeJoinExec.doExecute(SortMergeJoinExec.scala:267)
2024-01-15 14:31:46 WARN Executor: Executor ID: 3, Host: worker-node-05
2024-01-15 14:31:46 ERROR MemoryManager: Unable to allocate memory for shuffle buffer
2024-01-15 14:31:46 ERROR MemoryManager: Execution memory: 3.2GB / 3.2GB (100% used)
2024-01-15 14:31:46 ERROR MemoryManager: Storage memory: 2.4GB / 3.2GB (75% used)
2024-01-15 14:31:46 ERROR MemoryManager: Used heap: 7.7GB / 8.0GB (96% used)
2024-01-15 14:31:46 WARN MemoryManager: Off-heap memory: 512MB / 512MB (100% used)
2024-01-15 14:31:47 ERROR ShuffleExternalSorter: Unable to grow in-memory map from 524288 records to accommodate 1048576 records
java.lang.OutOfMemoryError: Unable to acquire 268435456 bytes of memory, got 0
	at org.apache.spark.memory.MemoryConsumer.allocateArray(MemoryConsumer.java:100)
	at org.apache.spark.shuffle.sort.ShuffleExternalSorter.growPointerArrayIfNecessary(ShuffleExternalSorter.java:371)
	at org.apache.spark.shuffle.sort.ShuffleExternalSorter.insertRecord(ShuffleExternalSorter.java:405)
	at org.apache.spark.shuffle.sort.UnsafeShuffleWriter.insertRecordIntoSorter(UnsafeShuffleWriter.java:214)
2024-01-15 14:31:47 ERROR Executor: Managed memory 5.1GB, 1024MB spilled to disk
2024-01-15 14:31:47 WARN NettyBlockTransferService: Direct buffer memory exhausted
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at io.netty.buffer.PoolArena$DirectArena.allocateDirect(PoolArena.java:764)
	at io.netty.buffer.PoolArena$DirectArena.newChunk(PoolArena.java:740)
	at io.netty.buffer.PoolArena.allocateNormal(PoolArena.java:244)
2024-01-15 14:31:48 ERROR TaskSetManager: Task 127.3 in stage 4.0 failed 4 times; aborting job
2024-01-15 14:31:48 WARN TaskMemoryManager: Failed to allocate a page (268435456 bytes), try again
2024-01-15 14:31:48 ERROR TaskMemoryManager: Out of memory while acquiring page
2024-01-15 14:31:48 INFO ShuffleBlockFetcherIterator: Getting 3472 non-empty blocks including 3472 local blocks and 0 remote blocks
2024-01-15 14:31:48 WARN ShuffleBlockFetcherIterator: Failed to fetch block shuffle_2_456_127 from executor 7
2024-01-15 14:31:49 ERROR CoarseGrainedExecutorBackend: RECEIVED SIGNAL TERM
2024-01-15 14:31:49 WARN CoarseGrainedExecutorBackend: Executor self-exiting due to memory pressure
2024-01-15 14:31:49 INFO ShutdownHookManager: Shutdown hook called
2024-01-15 14:31:49 INFO ShutdownHookManager: Deleting directory /tmp/spark-a3f8b9c2-4e56-7890-abcd-ef1234567890
2024-01-15 14:31:49 ERROR SparkContext: Error in stage 4.0 after 3472 tasks completed - executor 3 lost
2024-01-15 14:31:49 INFO DAGScheduler: ShuffleMapStage 4 (join at transaction_aggregator.py:87) failed in 347.823 s due to Lost executor
2024-01-15 14:31:49 INFO DAGScheduler: Job 2 failed: aggregate at transaction_aggregator.py:104, took 451.892634 s
2024-01-15 14:31:49 ERROR ApplicationMaster: User application exited with status 1
2024-01-15 14:31:50 WARN ExecutorAllocationManager: Unable to reach executor 3 on worker-node-05
2024-01-15 14:31:50 INFO BlockManagerMasterEndpoint: Trying to remove executor 3 from BlockManagerMaster
2024-01-15 14:31:50 INFO BlockManagerMaster: Removed 3 successfully in removeExecutor
2024-01-15 14:31:50 INFO DAGScheduler: Executor lost: 3 (epoch 7) on worker-node-05:43821
2024-01-15 14:31:50 ERROR StandaloneSchedulerBackend: Asked to remove non-existent executor 3
2024-01-15 14:31:50 WARN HeartbeatReceiver: Removing executor 3 with no recent heartbeats: 67384 ms exceeds timeout 60000 ms
2024-01-15 14:31:50 INFO TaskSchedulerImpl: Cancelling stage 4
2024-01-15 14:31:50 INFO TaskSchedulerImpl: Stage 4 was cancelled
2024-01-15 14:31:50 INFO DAGScheduler: ResultStage 5 (aggregate) cancelled due to job cancellation
2024-01-15 14:31:50 ERROR Utils: Uncaught exception in thread shuffle-client-worker-1
java.lang.OutOfMemoryError: Java heap space
	at java.nio.HeapByteBuffer.<init>(HeapByteBuffer.java:57)
	at java.nio.ByteBuffer.allocate(ByteBuffer.java:335)
	at org.apache.spark.network.buffer.NettyManagedBuffer.nioByteBuffer(NettyManagedBuffer.java:89)