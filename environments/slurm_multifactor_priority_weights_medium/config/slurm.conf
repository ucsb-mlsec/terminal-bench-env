# SLURM Configuration File
# Cluster: HPC-Production
# Priority Configuration: MISCONFIGURED - NEEDS FIXING

ClusterName=hpc-prod
SlurmctldHost=slurm-controller01
SlurmctldPort=6817
SlurmdPort=6818
AuthType=auth/munge
StateSaveLocation=/var/spool/slurm/ctld
SlurmdSpoolDir=/var/spool/slurm/d
SwitchType=switch/none
MpiDefault=none
SlurmctldLogFile=/var/log/slurm/slurmctld.log
SlurmdLogFile=/var/log/slurm/slurmd.log
JobCompType=jobcomp/none
ProctrackType=proctrack/cgroup
ReturnToService=1
SchedulerType=sched/backfill

# ACCOUNTING AND PRIORITY CONFIGURATION
# WARNING: Priority weights are misconfigured!
AccountingStorageType=accounting_storage/slurmdbd
AccountingStorageHost=slurm-db01
AccountingStoragePort=6819

# MULTIFACTOR PRIORITY PLUGIN CONFIGURATION
# PROBLEMS IDENTIFIED:
# 1. Age weight is 0 - jobs don't gain priority while waiting
# 2. QoS weight (1000) is too low - should be the dominant factor
# 3. Fairshare weight (8000) is too high - dominating over QoS
# 4. Decay half-life is 1 hour - causes rapid priority fluctuations
PriorityType=priority/multifactor
PriorityWeightAge=0
PriorityWeightQOS=1000
PriorityWeightFairshare=8000
PriorityWeightPartition=2000
PriorityDecayHalfLife=0-01:00:00
PriorityMaxAge=7-0
PriorityFavorSmall=NO
PriorityFlags=SMALL_RELATIVE_TO_TIME

# QOS DEFINITIONS
# These are correctly configured with increasing priorities
# QoS: low - Priority=100
# QoS: normal - Priority=500  
# QoS: high - Priority=1000
# But the low PriorityWeightQOS means these don't have enough impact!

# NODE DEFINITIONS
NodeName=node[001-050] CPUs=32 RealMemory=128000 State=UNKNOWN
NodeName=node[051-100] CPUs=64 RealMemory=256000 State=UNKNOWN

# PARTITION DEFINITIONS
PartitionName=standard Nodes=node[001-050] Default=YES MaxTime=48:00:00 State=UP Priority=50
PartitionName=himem Nodes=node[051-100] MaxTime=72:00:00 State=UP Priority=100

# The priority calculation is broken because:
# - Jobs never gain priority from waiting (Age=0)
# - High QoS jobs don't get enough priority boost (QoS weight too low)
# - Fair-share dominates everything (weight=8000 vs QoS=1000)
# - Priorities change every hour due to short decay half-life