[
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"<analysis>"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"The task requires fixing a payment processor that has bugs causing:"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"1. Duplicate processing"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"2. Lost messages"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"3. State file and completed directory sync issues"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"4. Inconsistent state after crashes"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"The key to exactly-once processing is:"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"1. Check if payment_id exists in state BEFORE processing"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"2. Atomically update state and move files"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"3. Handle crashes gracefully"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"4. Ensure idempotency"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"<\/analysis>"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"<fixed_processor>"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"```python"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"#!\/usr\/bin\/env python3"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"import json"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"import os"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"import shutil"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"from pathlib import Path"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"QUEUE_DIR = \"\/workspace\/queue\""
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"COMPLETED_DIR = \"\/workspace\/completed\""
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"STATE_FILE = \"\/workspace\/state.json\""
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"def load_state():"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"    \"\"\"Load the set of processed payment IDs\"\"\""
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"    if os.path.exists(STATE_FILE):"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"        try:"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"                data = json.load(f)"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"            return set()"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"    return set()"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"def save_state(processed_ids):"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"    \"\"\"Save the set of processed payment IDs atomically\"\"\""
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"    temp_file = STATE_FILE + '.tmp'"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"    try:"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"        # Atomic rename"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"    except Exception as e:"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"        if os.path.exists(temp_file):"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"            os.remove(temp_file)"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"        raise e"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"def process_payment(payment_data):"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"    \"\"\"Process a payment (placeholder for actual business logic)\"\"\""
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"    print(f\"Processing payment {payment_data['payment_id']}: ${payment_data['amount']}\")"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"def process_messages():"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"    \"\"\"Process all pending messages with exactly-once semantics\"\"\""
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"    # Ensure directories exist"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"    # Load current state"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"    processed_ids = load_state()"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"    # Get all message files"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"    message_files = sorted([f for f in os.listdir(QUEUE_DIR) if f.endswith('.json')])"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"    duplicates = 0"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"    newly_processed = 0"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"    for filename in message_files:"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"        try:"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"            # Read the message"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"                payment_data = json.load(f)"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"            payment_id = payment_data['payment_id']"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"            # Check if already processed (idempotency check)"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"            if payment_id in processed_ids:"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"                print(f\"Skipping already processed payment: {payment_id}\")"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"                duplicates += 1"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"                # Move to completed anyway to clean up queue"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"                if not os.path.exists(dest_path):"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"                else:"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"                    os.remove(filepath)"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"                continue"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"            # Process the payment"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"            process_payment(payment_data)"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"            # Update state BEFORE moving file (critical for crash recovery)"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"            processed_ids.add(payment_id)"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"            save_state(processed_ids)"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"            # Move to completed directory"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"            newly_processed += 1"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"        except Exception as e:"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"            print(f\"Error processing {filename}: {e}\")"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"            continue"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"if __name__ == \"__main__\":"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"    print(f\"\\nSummary:\")"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"    print(f\"Total unique payments processed: {total_processed}\")"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"    print(f\"Duplicates detected: {duplicates}\")"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"```"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"<\/fixed_processor>"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"Now let me create the complete test environment with all necessary files:"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"```python"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"#!\/usr\/bin\/env python3"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"import json"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"import os"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"import shutil"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"# Setup directories"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"# Create 10 test payment files"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"payments = ["
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"]"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"for payment in payments:"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"    filename = f\"\/workspace\/queue\/payment_{payment['payment_id'].split('_')[1]}.json\""
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"print(\"Test environment created successfully!\")"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"```"
  },
  {
    "I need to analyze the broken processor and fix it to ensure exactly-once processing semantics. Let me start by examining the current state of the system.":"Now let me create the actual solution by writing all the files:"
  }
]