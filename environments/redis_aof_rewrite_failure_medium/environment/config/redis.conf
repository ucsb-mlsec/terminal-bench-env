# Redis configuration file

# Network settings
bind 127.0.0.1
port 6379
timeout 0

# General settings
daemonize no
supervised no
loglevel notice
logfile /var/log/redis/redis-server.log

# Working directory - all persistent data stored here
dir /var/lib/redis/

# AOF persistence configuration
appendonly yes
appendfilename "appendonly.aof"

# AOF rewrite configuration
# Automatic rewrite triggered when AOF grows by 100% and is at least 64MB
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# Use RDB format as preamble in AOF for faster loading
aof-use-rdb-preamble yes

# Incremental fsync during AOF rewrite to avoid large I/O spikes
aof-rewrite-incremental-fsync yes

# AOF fsync policy - fsync every second (good balance of performance and safety)
appendfsync everysec
no-appendfsync-on-rewrite no

# Temporary file location for AOF rewrite operations
# IMPORTANT: This directory must exist and be writable by the redis user
# During AOF rewrite, temporary files are created here before replacing the main AOF
aof-rewrite-temp-dir /mnt/tmpfs/redis-aof-rewrite/

# Memory management
maxmemory-policy noeviction

# Snapshotting disabled (relying on AOF)
save ""

# Security
protected-mode yes

# Limits
maxclients 10000