#!/bin/bash

# Mock Azure CLI for testing
# TODO: Complete implementation - currently broken

CONFIG_DIR="/tmp/.azure"
CONFIG_FILE="$CONFIG_DIR/config.json"
CREDS_FILE="/tmp/test_credentials.txt"

# TODO: Fix device code login - incomplete
function device_code_login() {
    echo "Starting device code authentication flow..."
    
    # TODO: Generate proper device code
    DEVICE_CODE="ABC"
    
    # TODO: Show verification URL
    echo "Device code:"
    
    # TODO: Read credentials from test file
    
    # TODO: Create config directory if not exists
    
    # TODO: Store auth state - this part is broken
    echo "{}" > $CONFIG_FILE
    
    echo "Authentication incomplete"
}

# TODO: Fix account show function
function show_account() {
    # TODO: Check if config file exists
    
    # TODO: Read from config file properly
    if [ -f "$CONFIG_FILE" ]; then
        cat $CONFIG_FILE
    else
        echo "No account logged in"
        exit 1
    fi
}

# TODO: Implement logout
function logout() {
    # TODO: Remove config file
    echo "Logged out"
}

# Command parsing - partially working
case "$1" in
    "login")
        if [ "$2" == "--use-device-code" ]; then
            device_code_login
        fi
        ;;
    "account")
        if [ "$2" == "show" ]; then
            show_account
        fi
        ;;
    "logout")
        logout
        ;;
    *)
        echo "Unknown command"
        exit 1
        ;;
esac