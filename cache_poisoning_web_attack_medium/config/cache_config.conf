# Cache Configuration File
# Production Caching Layer - Varnish VCL Style Configuration
# Last Modified: 2024-01-15

# =============================================================================
# CACHE KEY CONFIGURATION
# =============================================================================
# Headers listed here are INCLUDED in the cache key generation
# Different values for these headers will result in separate cache entries

cache_key_includes:
  - Host                    # Domain name - essential for multi-tenant apps
  - Accept-Encoding         # Compression preferences (gzip, br, etc)
  - Accept-Language         # Language preference for i18n content
  - Cookie                  # Session/auth cookies affect personalized content
  - Accept                  # Content-Type negotiation

# =============================================================================
# UNKEYED HEADERS CONFIGURATION
# =============================================================================
# Headers listed here are EXCLUDED from the cache key but ARE forwarded
# to the backend application for processing
# 
# WARNING: These headers can be manipulated by attackers to poison the cache
# since different values will NOT create separate cache entries but WILL
# affect the backend response that gets cached

cache_key_excludes:
  - User-Agent              # Browser identification - too variable for caching
  - X-Forwarded-For         # Client IP forwarding - varies per request
  - X-Forwarded-Proto       # Protocol detection (http/https)
  - X-Forwarded-Host        # Original host header from proxy
  - X-Original-URL          # URL rewrite information from upstream
  - Referer                 # Referrer tracking - not relevant for cache
  - Accept-Datetime         # Memento protocol support
  - From                    # Email of requesting user agent
  - X-Custom-Header         # Application-specific custom header

# =============================================================================
# CACHE TTL SETTINGS
# =============================================================================

default_ttl: 300                    # 5 minutes default cache lifetime
static_content_ttl: 3600            # 1 hour for static assets
api_response_ttl: 60                # 1 minute for API endpoints
max_stale: 86400                    # Serve stale content up to 24 hours if backend down

# =============================================================================
# CACHE SIZE LIMITS
# =============================================================================

max_cache_size: 1GB
max_object_size: 10MB
min_object_size: 1KB

# =============================================================================
# PATH-SPECIFIC CACHE RULES
# =============================================================================

cache_rules:
  - path: /static/*
    ttl: 3600
    cache_methods: GET, HEAD
    
  - path: /api/*
    ttl: 60
    cache_methods: GET
    
  - path: /dynamic/*
    ttl: 300
    cache_methods: GET
    respect_cache_control: true

  - path: /admin/*
    cacheable: false

# =============================================================================
# CACHE BEHAVIOR
# =============================================================================

strip_query_params: false           # Keep query strings in cache key
normalize_query_params: true        # Sort params alphabetically
ignore_unknown_headers: false       # Forward all headers to backend
grace_mode: true                    # Serve stale content during backend issues