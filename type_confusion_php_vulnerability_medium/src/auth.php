<?php
// auth.php - Authentication helper functions for the web application

require_once 'config.php';

/**
 * Validates user password against stored hash
 * Compares input password hash with stored hash from database
 * 
 * @param string $input - User provided password
 * @param string $hash - Stored password hash from database
 * @return bool - True if password matches, false otherwise
 */
function validate_password($input, $hash) {
    // Hash the input password using MD5
    $input_hash = md5($input);
    
    // Compare hashes - using loose comparison for flexibility
    if ($input_hash == $hash) {
        return true;
    }
    return false;
}

/**
 * Retrieves user information from the users array
 * 
 * @param string $username - Username to lookup
 * @return array|null - User data array or null if not found
 */
function get_user($username) {
    global $users;
    
    if (isset($users[$username])) {
        return $users[$username];
    }
    return null;
}

/**
 * Creates a session for authenticated user
 * Sets session variables for user identification
 * 
 * @param array $user - User data array
 * @return void
 */
function create_session($user) {
    session_start();
    $_SESSION['authenticated'] = true;
    $_SESSION['username'] = $user['username'];
    $_SESSION['role'] = $user['role'];
    $_SESSION['user_id'] = $user['id'];
}

/**
 * Checks if current session is authenticated
 * 
 * @return bool - True if user is authenticated
 */
function is_authenticated() {
    session_start();
    return isset($_SESSION['authenticated']) && $_SESSION['authenticated'] === true;
}

/**
 * Destroys current session and logs out user
 * 
 * @return void
 */
function logout() {
    session_start();
    session_destroy();
    $_SESSION = array();
}