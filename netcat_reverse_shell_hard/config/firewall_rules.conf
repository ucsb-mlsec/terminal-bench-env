# Generated by iptables-save v1.8.7 on Mon Jan 15 08:23:14 2024
*filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]

# Loopback interface - always allow
-A INPUT -i lo -j ACCEPT
-A OUTPUT -o lo -j ACCEPT

# Allow established and related connections
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
-A FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT

# SSH access - standard port
-A INPUT -p tcp -m tcp --dport 22 -m state --state NEW -j ACCEPT

# HTTP and HTTPS services
-A INPUT -p tcp -m tcp --dport 80 -m state --state NEW -j ACCEPT
-A INPUT -p tcp -m tcp --dport 443 -m state --state NEW -j ACCEPT

# Docker daemon ports
-A INPUT -p tcp -m tcp --dport 2375 -s 172.17.0.0/16 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 2376 -s 172.17.0.0/16 -j ACCEPT

# Docker network bridges
-A FORWARD -i docker0 -o docker0 -j ACCEPT
-A FORWARD -i docker0 ! -o docker0 -j ACCEPT
-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT

# DNS resolution
-A INPUT -p udp -m udp --dport 53 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 53 -j ACCEPT

# Application server ports
-A INPUT -p tcp -m tcp --dport 4000 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 4001 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 4444 -s 0.0.0.0/0 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 4500 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 5000 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 5001 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 5432 -s 172.17.0.0/16 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 6000 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 6379 -s 127.0.0.1/32 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 6500 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 7000 -s 0.0.0.0/0 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 7001 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 7777 -j ACCEPT # Added 2024-01-15
-A INPUT -p tcp -m tcp --dport 8000 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 8080 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 8443 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 8888 -s 0.0.0.0/0 -j ACCEPT # monitoring service
-A INPUT -p tcp -m tcp --dport 9000 -j ACCEPT

# Additional service ports - Added 2024-01-14
-A INPUT -p tcp -m tcp --dport 4242 -s 0.0.0.0/0 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 4343 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 5555 -s 0.0.0.0/0 -j ACCEPT

# Block common attack ports
-A INPUT -p tcp -m tcp --dport 23 -j DROP
-A INPUT -p tcp -m tcp --dport 135 -j DROP
-A INPUT -p tcp -m tcp --dport 139 -j DROP
-A INPUT -p tcp -m tcp --dport 445 -j DROP
-A INPUT -p tcp -m tcp --dport 1433 -j DROP
-A INPUT -p tcp -m tcp --dport 3389 -j DROP

# ICMP - rate limited
-A INPUT -p icmp -m icmp --icmp-type 8 -m limit --limit 1/sec -j ACCEPT
-A INPUT -p icmp -m icmp --icmp-type 8 -j DROP

# NTP service
-A INPUT -p udp -m udp --dport 123 -j ACCEPT

# Custom application ports
-A INPUT -p tcp -m tcp --dport 8001 -s 0.0.0.0/0 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 8002 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 8181 -j ACCEPT

# Legacy services - review needed # Added 2024-01-15
-A INPUT -p tcp -m tcp --dport 9999 -s 0.0.0.0/0 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 9001 -j ACCEPT

# Database access - restricted
-A INPUT -p tcp -m tcp --dport 3306 -s 172.17.0.0/16 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 27017 -s 127.0.0.1/32 -j ACCEPT

# Reject all other incoming traffic
-A INPUT -j REJECT --reject-with icmp-port-unreachable
-A FORWARD -j REJECT --reject-with icmp-port-unreachable

COMMIT
# Completed on Mon Jan 15 08:23:14 2024