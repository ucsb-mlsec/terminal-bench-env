#!/bin/bash

# Fix the build system by adding library search path to Makefile
cd /workspace/project

# Backup original Makefile
cp Makefile Makefile.backup

# Add -L flag to specify library search path
# The linker needs to know where to find the libraries
sed -i 's/-lmath -lutils/-L$(PWD)\/libs -lmath -lutils/g' Makefile

# Alternative approach if the above doesn't work - add LDFLAGS
if ! grep -q "LDFLAGS" Makefile; then
    # Add LDFLAGS variable near the top of Makefile
    sed -i '1a LDFLAGS = -L./libs' Makefile
    # Update linking command to use LDFLAGS
    sed -i 's/\$(CC)/\$(CC) \$(LDFLAGS)/g' Makefile
fi

# Ensure the build directory exists
mkdir -p /workspace/project/build

echo "FIXED"