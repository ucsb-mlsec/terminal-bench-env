SPARK THRIFT SERVER RESOURCE REQUIREMENTS
================================================

VERSION: 3.4.0
LAST UPDATED: 2024-01-15

SECTION 1: MEMORY REQUIREMENTS PER SESSION
-------------------------------------------

Driver Memory Per Session:
- Base driver memory: 512 MB per session
- Metadata cache overhead: 128 MB per session
- Result buffer memory: 256 MB per session
- Total driver memory per session: 896 MB

Executor Memory Allocation:
- Executors are shared across sessions in dynamic allocation mode
- Each session can claim up to 2 executors from the shared pool
- Executor memory per executor instance: 2048 MB
- Memory overhead per executor: 512 MB (included in executor memory)
- Total executor memory per session: 2 executors × 2048 MB = 4096 MB

Connection Buffer Memory:
- JDBC connection buffer: 64 MB per connection
- Each session maintains 2 active JDBC connections
- Total connection buffer per session: 128 MB

TOTAL MEMORY PER SESSION FORMULA:
896 MB (driver) + 4096 MB (executors) + 128 MB (connections) = 5120 MB per session


SECTION 2: CPU REQUIREMENTS PER SESSION
----------------------------------------

CPU Core Allocation:
- Driver cores per session: 1 core (dedicated)
- Executor cores per executor: 4 cores
- Each session uses 2 executors
- Total executor cores per session: 2 executors × 4 cores = 8 cores

TOTAL CPU CORES PER SESSION:
1 (driver) + 8 (executors) = 9 cores per session


SECTION 3: CONNECTION POOL LIMITS
----------------------------------

JDBC Connection Pool:
- Maximum JDBC connections in pool: 200 connections
- Each session requires: 2 JDBC connections
- Connection pool limit allows: 200 / 2 = 100 sessions maximum

Thrift Server Connections:
- Maximum Thrift server connections: 150 connections
- Each session requires: 1 Thrift connection
- Thrift connection limit allows: 150 sessions maximum

Worker Thread Pool:
- Worker thread pool size: 64 threads
- Each session requires: 1 worker thread minimum
- Thread pool limit allows: 64 sessions maximum


SECTION 4: EXECUTOR POOL CONSTRAINTS
-------------------------------------

Dynamic Executor Allocation:
- Maximum total executors in cluster pool: 80 executors
- Each session allocates: 2 executors (non-shared, dedicated during query)
- Executor limit allows: 80 / 2 = 40 sessions maximum

Note: Executors are allocated on-demand but count against the session
until explicitly released. Under high concurrency, assume all sessions
hold their maximum executor allocation simultaneously.


SECTION 5: BOTTLENECK CALCULATION
----------------------------------

To determine maximum safe concurrent sessions, calculate the limit
imposed by each resource type and select the MINIMUM value:

1. Memory limit = Total Available Memory / 5120 MB per session
2. CPU limit = Total Available CPU Cores / 9 cores per session
3. JDBC connection limit = 200 / 2 = 100 sessions
4. Thrift connection limit = 150 / 1 = 150 sessions
5. Worker thread limit = 64 / 1 = 64 sessions
6. Executor pool limit = 80 / 2 = 40 sessions

The maximum safe concurrent session limit is the MINIMUM of all above limits.