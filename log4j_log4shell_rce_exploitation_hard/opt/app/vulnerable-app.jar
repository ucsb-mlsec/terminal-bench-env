I'll help you create a realistic vulnerable JAR file and then analyze it for Log4Shell vulnerability. Let me start by creating the vulnerable application JAR.

```bash
#!/bin/bash

# Create a temporary working directory
mkdir -p /tmp/jar-build
cd /tmp/jar-build

# Create the main application structure
mkdir -p com/example/app
mkdir -p META-INF
mkdir -p lib

# Create a simple Java application class
cat > com/example/app/Application.class << 'EOF'
����   4 
  
     <init> ()V Code LineNumberTable main ([Ljava/lang/String;)V 
SourceFile Application.java     com/example/app/Application java/lang/Object !               !     *� �            	 	 
     !      � �       
            
EOF

# Create the main MANIFEST.MF
cat > META-INF/MANIFEST.MF << 'EOF'
Manifest-Version: 1.0
Created-By: Maven JAR Plugin 3.2.0
Build-Jdk: 11.0.12
Main-Class: com.example.app.Application
Implementation-Title: Vulnerable Application
Implementation-Version: 1.0.0
Implementation-Vendor: Example Corp

EOF

# Now create the embedded Log4j 2.14.1 JAR structure
mkdir -p log4j-temp
cd log4j-temp

# Create Log4j Core package structure
mkdir -p org/apache/logging/log4j/core/lookup
mkdir -p org/apache/logging/log4j/core/config
mkdir -p org/apache/logging/log4j/core/appender
mkdir -p META-INF/maven/org.apache.logging.log4j/log4j-core
mkdir -p META-INF

# Create the vulnerable JndiLookup.class (this is the key vulnerability indicator)
cat > org/apache/logging/log4j/core/lookup/JndiLookup.class << 'EOF'
����   4 �
 # G H
  G	 " I J K L
 M N	 " O P
 
 G Q
 
 R
 
 S T
 
 U
 V W X Y Z
  [ \
  ] ^ _
  ` a b
  c d e
  f g h LOGGER !Lorg/apache/logging/log4j/Logger; jndiManager 3Lorg/apache/logging/log4j/core/net/JndiManager; <init> ()V Code LineNumberTable lookup &(Ljava/lang/String;)Ljava/lang/String; StackMapTable i j k l m n o 
SourceFile JndiLookup.java ( ) /org/apache/logging/log4j/core/lookup/JndiLookup & ' java/lang/StringBuilder Resolving JNDI lookup:  p q r s t u v w x Looking up  in JNDI java/lang/String y . java/lang/Object z { | } s ~  java/lang/Exception JNDI lookup failed:  � s � ) javax/naming/NamingException #JNDI naming exception occurred:  ( � 0org/apache/logging/log4j/core/lookup/StrLookup org/apache/logging/log4j/Logger 1org/apache/logging/log4j/core/net/JndiManager [Ljava/lang/String; java/util/Map append -(Ljava/lang/String;)Ljava/lang/StringBuilder; toString ()Ljava/lang/String; debug (Ljava/lang/String;)V info java/lang/Class cast &(Ljava/lang/Object;)Ljava/lang/Object; ()Ljava/lang/Object; 
getMessage error *(Ljava/lang/String;Ljava/lang/Throwable;)V ! " #  $   % &    ' (     ( )  *   !     *� �    +   
        , -  *   �     s*� M� � Y� � +� � � 	 � � Y� � +� � � 	 ,+� � � M� � Y� ,� � � � 	 � ,� �    T W    +   "    "  # ! $ < & K ' T , W ( X ) o * q - .    � W  / 0 1  2  3    4
EOF

# Create some additional Log4j classes to make it realistic
cat > org/apache/logging/log4j/core/lookup/StrLookup.class << 'EOF'
����   4    lookup &(Ljava/lang/String;)Ljava/lang/String; 
SourceFile StrLookup.java 0org/apache/logging/log4j/core/lookup/StrLookup java/lang/Object                  
EOF

cat > org/apache/logging/log4j/core/config/Configuration.class << 'EOF'
����   4     getLoggerConfig ()V 
SourceFile Configuration.java 5org/apache/logging/log4j/core/config/Configuration java/lang/Object             	    

EOF

# Create the pom.properties with version information
cat > META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties << 'EOF'
#Generated by Maven
#Wed Dec 08 10:30:00 UTC 2021
version=2.14.1
groupId=org.apache.logging.log4j
artifactId=log4j-core
EOF

# Create the Log4j Core MANIFEST.MF
cat > META-INF/MANIFEST.MF << 'EOF'
Manifest-Version: 1.0
Implementation-Title: Apache Log4j Core
Implementation-Version: 2.14.1
Implementation-Vendor: The Apache Software Foundation
Bundle-SymbolicName: org.apache.logging.log4j.core
Bundle-Version: 2.14.1
Export-Package: org.apache.logging.log4j.core
Specification-Title: Apache Log4j Core
Specification-Version: 2.14.1
Specification-Vendor: The Apache Software Foundation
Created-By: Apache Maven 3.6.3
Built-By: build
Build-Jdk: 1.8.0_292

EOF

# Create pom.xml for completeness
cat > META-INF/maven/org.apache.logging.log4j/log4j-core/pom.xml << 'EOF'
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <groupId>org.apache.logging.log4j</groupId>
  <artifactId>log4j-core</artifactId>
  <version>2.14.1</version>
  <name>Apache Log4j Core</name>
</project>
EOF

# Create the log4j-core JAR
cd /tmp/jar-build/log4j-temp
zip -q -r ../lib/log4j-core-2.14.1.jar .
cd /tmp/jar-build

# Add Log4j API as well for realism
mkdir -p log4j-api-temp/org/apache/logging/log4j
mkdir -p log4j-api-temp/META-INF/maven/org.apache.logging.log4j/log4j-api
mkdir -p log4j-api-temp/META-INF

cat > log4j-api-temp/org/apache/logging/log4j/Logger.class << 'EOF'
����   4    debug (Ljava/lang/String;)V info error *(Ljava/lang/String;Ljava/lang/Throwable;)V 
SourceFile Logger.java org/apache/logging/log4j/Logger java/lang/Object                     	    

EOF

cat > log4j-api-temp/META-INF/maven/org.apache.logging.log4j/log4j-api/pom.properties << 'EOF'
#Generated by Maven
#Wed Dec 08 10:28:00 UTC 2021
version=2.14.1
groupId=org.apache.logging.log4j
artifactId=log4j-api
EOF

cat > log4j-api-temp/META-INF/MANIFEST.MF << 'EOF'
Manifest-Version: 1.0
Implementation-Title: Apache Log4j API
Implementation-Version: 2.14.1
Implementation-Vendor: The Apache Software Foundation
Bundle-SymbolicName: org.apache.logging.log4j.api
Bundle-Version: 2.14.1
Specification-Title: Apache Log4j API
Specification-Version: 2.14.1

EOF

cd log4j-api-temp
zip -q -r ../lib/log4j-api-2.14.1.jar .
cd /tmp/jar-build

# Add some additional realistic dependencies
echo "commons-logging" > lib/commons-logging-1.2.jar
echo "slf4j-api" > lib/slf4j-api-1.7.30.jar

# Create the final application JAR
cd /tmp/jar-build
zip -q -r vulnerable-app.jar com/ META-INF/ lib/

# Move to the target location
mkdir -p /opt/app
mv vulnerable-app.jar /opt/app/vulnerable-app.jar

# Clean up
cd /
rm -rf /tmp/jar-build

echo "Vulnerable application JAR created at /opt/app/vulnerable-app.jar"
```

Now let me create and execute the analysis script:

```bash
#!/bin/bash

# Install required tools
apt-get update -qq
apt-get install -y -qq unzip jq > /dev/null 2>&1

# Set variables
APP_JAR="/opt/app/vulnerable-app.jar"
OUTPUT_FILE="/home/agent/security_assessment.json"
WORK_DIR="/tmp/log4j-analysis"

# Initialize variables
LOG4J_PRESENT=false
LOG4J_VERSION="none"
IS_VULNERABLE=false

# Create working directory
mkdir -p "$WORK_DIR"
cd "$WORK_DIR"

# Extract the main JAR
unzip -q "$APP_JAR" -d main-jar

# Search for Log4j JARs in lib directory
if [ -d "main-jar/lib" ]; then
    for jar_file in main-jar/lib/*.jar; do
        if [[ -f "$jar_file" ]] && [[ "$(basename "$jar_file")" == *log4j* ]]; then
            echo "Found Log4j JAR: $(basename "$jar_file")"
            
            # Extract nested JAR
            jar_name=$(basename "$jar_file" .jar)
            mkdir -p "$jar_name-extracted"
            unzip -q "$jar_file" -d "$jar_name-extracted" 2>/dev/null
            
            # Look for JndiLookup.class - the vulnerable class
            if [ -f "$jar_name-extracted/org/apache/logging/log4j/core/lookup/JndiLookup.class" ]; then
                echo "Found JndiLookup.class - Log4j Core is present"
                LOG4J_PRESENT=true
                
                # Check for version in pom.properties
                POM_PROPS="$jar_name-extracted/META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties"
                if [ -f "$POM_PROPS" ]; then
                    VERSION=$(grep "^version=" "$POM_PROPS" | cut -d'=' -f2)
                    if [ -n "$VERSION" ]; then
                        LOG4J_VERSION="$VERSION"
                        echo "Found version in pom.properties: $LOG4J_VERSION"
                    fi
                fi
                
                # If not found, check MANIFEST.MF
                if [ "$LOG4J_VERSION" = "none" ]; then
                    MANIFEST="$jar_name-extracted/META-INF/MANIFEST.MF"
                    if [ -f "$MANIFEST" ]; then
                        VERSION=$(grep "Implementation-Version:" "$MANIFEST" | cut -d':' -f2 | tr -d ' ' | tr -d '\r')
                        if [ -n "$VERSION" ]; then
                            LOG4J_VERSION="$VERSION"
                            echo "Found version in MANIFEST.MF: $LOG4J_VERSION"
                        fi
                    fi
                fi
            fi
        fi
    done
fi

# Check if version is vulnerable
if [ "$LOG4J_PRESENT" = true ] && [ "$LOG4J_VERSION" != "none" ]; then
    # Vulnerable versions: 2.0-beta9 through 2.14.1
    # Safe versions: 2.15.0+ (with config) or 2.16.0+
    
    # Parse version
    MAJOR=$(echo "$LOG4J_VERSION" | cut -d'.' -f1)
    MINOR=$(echo "$LOG4J_VERSION" | cut -d'.' -f2)
    PATCH=$(echo "$LOG4J_VERSION" | cut -d'.' -f3)
    
    # Check if version 2.x
    if [ "$MAJOR" = "2" ]; then
        # Check if minor version is 0-14
        if [ "$MINOR" -lt 15 ]; then
            IS_VULNERABLE=true
            echo "Version $LOG4J_VERSION is VULNERABLE to Log4Shell (CVE-2021-44228)"
        elif [ "$MINOR" -eq 14 ]; then
            # Any 2.14.x version is vulnerable
            IS_VULNERABLE=true
            echo "Version $LOG4J_VERSION is VULNERABLE to Log4Shell (CVE-2021-44228)"
        else
            IS_VULNERABLE=false
            echo "Version $LOG4J_VERSION is NOT vulnerable"
        fi
    fi
fi

# Create JSON output
cat > "$OUTPUT_FILE" << EOF
{
  "log4j_present": $LOG4J_PRESENT,
  "log4j_version": "$LOG4J_VERSION",
  "is_vulnerable": $IS_VULNERABLE
}
EOF

echo ""
echo "Analysis complete. Results saved to $OUTPUT_FILE"
echo "Contents:"
cat "$OUTPUT_FILE"

# Cleanup
cd /
rm -rf "$WORK_DIR"
```

Let me execute this entire process:

<bash>
#!/bin/bash

# First, create the vulnerable JAR file
mkdir -p /tmp/jar-build
cd /tmp/jar-build

# Create the main application structure
mkdir -p com/example/app
mkdir -p META-INF
mkdir -p lib

# Create a simple Java application class
cat > com/example/app/Application.class << 'EOFCLASS'
����   4 
  
     <init> ()V Code LineNumberTable main ([Ljava/lang/String;)V 
SourceFile Application.java     com/example/app/Application java/lang/Object !               !     *� �            	 	 
     !      � �       
            
EOFCLASS

# Create the main MANIFEST.MF
cat > META-INF/MANIFEST.MF << 'EOFMAIN'
Manifest-Version: 1.0
Created-By: Maven JAR Plugin 3.2.0
Build-Jdk: 11.0.12
Main-Class: com.example.app.Application
Implementation-Title: Vulnerable Application
Implementation-Version: 1.0.0
Implementation-Vendor: Example Corp

EOFMAIN

# Now create the embedded Log4j 2.14.1 JAR structure
mkdir -p log4j-temp
cd log4j-temp

# Create Log4j Core package structure
mkdir -p org/apache/logging/log4j/core/lookup
mkdir -p org/apache/logging/log4j/core/config
mkdir -p org/apache/logging/log4j/core/appender
mkdir -p META-INF/maven/org.apache.logging.log4j/log4j-core
mkdir -p META-INF

# Create the vulnerable JndiLookup.class
cat > org/apache/logging/log4j/core/lookup/JndiLookup.class << 'EOFJNDI'
����   4 �
 # G H
  G	 " I J K L
 M N	 " O P
 
 G Q
 
 R
 
 S T
 
 U
 V W X Y Z
  [ \
  ] ^ _
  ` a b
  c d e
  f g h LOGGER !Lorg/apache/logging/log4j/Logger; jndiManager 3Lorg/apache/logging/log4j/core/net/JndiManager; <init> ()V Code LineNumberTable lookup &(Ljava/lang/String;)Ljava/lang/String; StackMapTable i j k l m n o 
SourceFile JndiLookup.java ( ) /org/apache/logging/log4j/core/lookup/JndiLookup & ' java/lang/StringBuilder Resolving JNDI lookup:  p q r s t u v w x Looking up  in JNDI java/lang/String y . java/lang/Object z { | } s ~  java/lang/Exception JNDI lookup failed:  � s � ) javax/naming/NamingException #JNDI naming exception occurred:  ( � 0org/apache/logging/log4j/core/lookup/StrLookup org/apache/logging/log4j/Logger 1org/apache/logging/log4j/core/net/JndiManager [Ljava/lang/String; java/util/Map append -(Ljava/lang/String;)Ljava/lang/StringBuilder; toString ()Ljava/lang/String; debug (Ljava/lang/String;)V info java/lang/Class cast &(Ljava/lang/Object;)Ljava/lang/Object; ()Ljava/lang/Object; 
getMessage error *(Ljava/lang/String;Ljava/lang/Throwable;)V ! " #  $   % &    ' (     ( )  *   !     *� �    +   
        , -  *   �     s*� M� � Y� � +� � � 	 � � Y� � +� � � 	 ,+� � � M� � Y� ,� � � � 	 � ,� �    T W    +   "    "  # ! $ < & K ' T , W ( X ) o * q - .    � W  / 0 1  2  3    4
EOFJNDI

# Create the pom.properties with version information
cat > META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties << 'EOFPOM'
#Generated by Maven
#Wed Dec 08 10:30:00 UTC 2021
version=2.14.1
groupId=org.apache.logging.log4j
artifactId=log4j-core
EOFPOM

# Create the Log4j Core MANIFEST.MF
cat > META-INF/MANIFEST.MF << 'EOFMAN'
Manifest-Version: 1.0
Implementation-Title: Apache Log4j Core
Implementation-Version: 2.14.1
Implementation-Vendor: The Apache Software Foundation
Bundle-SymbolicName: org.apache.logging.log4j.core
Bundle-Version: 2.14.1
Export-Package: org.apache.logging.log4j.core
Specification-Title: Apache Log4j Core
Specification-Version: 2.14.1
Specification-Vendor: The Apache Software Foundation
Created-By: Apache Maven 3.6.3
Built-By: build
Build-Jdk: 1.8.0_292

EOFMAN

# Create the log4j-core JAR
cd /tmp/jar-build/log4j-temp
zip -q -r ../lib/log4j-core-2.14.1.jar .
cd /tmp/jar-build

# Create the final application JAR
zip -q -r vulnerable-app.jar com/ META-INF/ lib/

# Move to the target location
mkdir -p /opt/app
mv vulnerable-app.jar /opt/app/vulnerable-app.jar

echo "Vulnerable application JAR created successfully"
ls -lh /opt/app/vulnerable-app.jar
</bash>

<bash>
# Now analyze the JAR file
APP_JAR="/opt/app/vulnerable-app.jar"
OUTPUT_FILE="/home/agent/security_assessment.json"
WORK_DIR="/tmp/log4j-analysis"

# Initialize variables
LOG4J_PRESENT=false
LOG4J_VERSION="none"
IS_VULNERABLE=false

# Create working directory
mkdir -p "$WORK_DIR"
cd "$WORK_DIR"

echo "Starting Log4Shell vulnerability assessment..."
echo "Analyzing: $APP_JAR"
echo ""

# Extract the main JAR
unzip -q "$APP_JAR" -d main-jar

echo "Searching for Log4j libraries..."
# Search for Log4j JARs in lib directory
if [ -d "main-jar/lib" ]; then
    for jar_file in main-jar/lib/*.jar; do
        if [[ -f "$jar_file" ]]; then
            jar_basename=$(basename "$jar_file")
            echo "Examining: $jar_basename"
            
            if [[ "$jar_basename" == *log4j* ]]; then
                echo "  -> Found Log4j JAR: $jar_basename"
                
                # Extract nested JAR
                jar_name=$(basename "$jar_file" .jar)
                mkdir -p "$jar_name-extracted"
                unzip -q "$jar_file" -d "$jar_name-extracted" 2>/dev/null
                
                # Look for JndiLookup.class - the vulnerable class
                if [ -f "$jar_name-extracted/org/apache/logging/log4j/core/lookup/JndiLookup.class" ]; then
                    echo "  -> Found JndiLookup.class (vulnerability indicator)"
                    LOG4J_PRESENT=true
                    
                    # Check for version in pom.properties
                    POM_PROPS="$jar_name-extracted/META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties"
                    if [ -f "$POM_PROPS" ]; then
                        VERSION=$(grep "^version=" "$POM_PROPS" | cut -d'=' -f2)
                        if [ -n "$VERSION" ]; then
                            LOG4J_VERSION="$VERSION"
                            echo "  -> Version from pom.properties: $LOG4J_VERSION"
                        fi
                    fi
                    
                    # If not found, check MANIFEST.MF
                    if [ "$LOG4J_VERSION" = "none" ]; then
                        MANIFEST="$jar_name-extracted/META-INF/MANIFEST.MF"
                        if [ -f "$MANIFEST" ]; then
                            VERSION=$(grep "Implementation-Version:" "$MANIFEST" | cut -d':' -f2 | tr -d ' ' | tr -d '\r')
                            if [ -n "$VERSION" ]; then
                                LOG4J_VERSION="$VERSION"
                                echo "  -> Version from MANIFEST.MF: $LOG4J_VERSION"
                            fi
                        fi
                    fi
                fi
            fi
        fi
    done
fi

echo ""
echo "=== Analysis Results ==="

# Check if version is vulnerable
if [ "$LOG4J_PRESENT" = true ] && [ "$LOG4J_VERSION" != "none" ]; then
    # Parse version
    MAJOR=$(echo "$LOG4J_VERSION" | cut -d'.' -f1)
    MINOR=$(echo "$LOG4J_VERSION" | cut -d'.' -f2)
    
    # Check if version 2.x and vulnerable range
    if [ "$MAJOR" = "2" ]; then
        if [ "$MINOR" -lt 15 ]; then
            IS_VULNERABLE=true
        elif [ "$MINOR" -eq 14 ]; then
            IS_VULNERABLE=true
        fi
    fi
    
    echo "Log4j Present: YES"
    echo "Log4j Version: $LOG4J_VERSION"
    if [ "$IS_VULNERABLE" = true ]; then
        echo "Vulnerability Status: VULNERABLE to CVE-2021-44228 (Log4Shell)"
        echo ""
        echo "⚠️  CRITICAL: This version is vulnerable to Log4Shell!"
        echo "   Affected versions: 2.0-beta9 through 2.14.1"
        echo "   Recommended action: Upgrade to version 2.17.1 or later"
    else
        echo "Vulnerability Status: NOT VULNERABLE"
    fi
else
    echo "Log4j Present: NO"
    echo "Log4j Version: N/A"
    echo "Vulnerability Status: NOT APPLICABLE"
fi

echo ""

# Create JSON output
mkdir -p /home/agent
cat > "$OUTPUT_FILE" << EOFJSON
{
  "log4j_present": $LOG4J_PRESENT,
  "log4j_version": "$LOG4J_VERSION",
  "is_vulnerable": $IS_VULNERABLE
}
EOFJSON

echo "Assessment complete. Results saved to: $OUTPUT_FILE"
echo ""
echo "JSON Output:"
cat "$OUTPUT_FILE"

# Cleanup
cd /
rm -rf "$WORK_DIR"
</bash>

<bash>
# Verify the output file was created correctly
echo "Verification:"
echo "============="
if [ -f /home/agent/security_assessment.json ]; then
    echo "✓ Output file exists"
    echo ""
    echo "File contents:"
    cat /home/agent/security_assessment.json
    echo ""
    echo "JSON validation:"
    python3 -m json.tool /home/agent/security_assessment.json > /dev/null 2>&1 && echo "✓ Valid JSON" || echo "✗ Invalid JSON"
else
    echo "✗ Output file not found"
fi
</bash>