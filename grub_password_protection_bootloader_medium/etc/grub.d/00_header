#!/bin/sh
exec tail -n +3 $0
# This file provides the header for GRUB2 menu configuration.
# This is the standard GRUB header file

cat <<EOF
# DO NOT EDIT THIS FILE
#
# It is automatically generated by grub-mkconfig using templates
# from /etc/grub.d and settings from /etc/default/grub
#

EOF

set -e

# grub-mkconfig helper script.
# Copyright (C) 2006,2007,2008,2009,2010  Free Software Foundation, Inc.
#
# GRUB is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.

prefix="/usr"
exec_prefix="${prefix}"
datarootdir="${prefix}/share"

. "$pkgdatadir/grub-mkconfig_lib"

# Set a default timeout
if [ "x${GRUB_TIMEOUT}" = "x" ] ; then
  GRUB_TIMEOUT=5
fi

# Set default timeout style
if [ "x${GRUB_TIMEOUT_STYLE}" = "x" ] ; then
  GRUB_TIMEOUT_STYLE=menu
fi

make_timeout ()
{
    cat << EOF
if [ "\${recordfail}" = 1 ] ; then
  set timeout=30
else
EOF
    if [ "x${GRUB_HIDDEN_TIMEOUT}" != "x" ] ; then
        cat << EOF
  set timeout=${GRUB_HIDDEN_TIMEOUT}
EOF
    else
        if [ "x${GRUB_TIMEOUT_STYLE}" = "xhidden" ] ; then
            cat << EOF
  set timeout=0
EOF
        else
            cat << EOF
  set timeout=${GRUB_TIMEOUT}
EOF
        fi
    fi
    cat << EOF
fi
EOF
}

cat << EOF
if [ -s \$prefix/grubenv ]; then
  set have_grubenv=true
  load_env
fi
EOF

if [ "x$GRUB_BUTTON_CMOS_ADDRESS" != "x" ]; then
    cat <<EOF
if [ "\${GRUB_BUTTON_CMOS_ADDRESS}" = "0" ]; then
  GRUB_BUTTON_CMOS_ADDRESS=$GRUB_BUTTON_CMOS_ADDRESS
fi
EOF
fi

cat <<EOF
if [ "\${prev_saved_entry}" ]; then
  set saved_entry="\${prev_saved_entry}"
  save_env saved_entry
  set prev_saved_entry=
  save_env prev_saved_entry
  set boot_once=true
fi

function savedefault {
  if [ -z "\${boot_once}" ]; then
    saved_entry="\${chosen}"
    save_env saved_entry
  fi
}

function recordfail {
  set recordfail=1
  if [ -n "\${have_grubenv}" ]; then if [ -z "\${boot_once}" ]; then save_env recordfail; fi; fi
}

function load_video {
  if [ x\$feature_all_video_module = xy ]; then
    insmod all_video
  else
    insmod efi_gop
    insmod efi_uga
    insmod ieee1275_fb
    insmod vbe
    insmod vga
    insmod video_bochs
    insmod video_cirrus
  fi
}
EOF

if [ "x$GRUB_TERMINAL" = "x" ] ; then
    cat << EOF
if [ x\$feature_default_font_path = xy ] ; then
   font=unicode
else
EOF
    cat << EOF
   font="\$prefix/fonts/unicode.pf2"
fi
EOF
    cat <<EOF

if loadfont \$font ; then
  set gfxmode=auto
  load_video
  insmod gfxterm
  set locale_dir=\$prefix/locale
  set lang=${GRUB_LANG}
  insmod gettext
fi
terminal_input console
terminal_output gfxterm
EOF
fi

make_timeout