#include <stdio.h>
#include <string.h>
#include <stdlib.h>

#define MAX_BUFFER 256
#define MAX_STATUS 128

typedef struct {
    char username[64];
    char status_format[128];
    int user_level;
} UserContext;

void initialize_context(UserContext *ctx) {
    if (ctx) {
        memset(ctx, 0, sizeof(UserContext));
        ctx->user_level = 0;
    }
}

char* trim_whitespace(char *str) {
    char *end;
    
    while(*str == ' ' || *str == '\t' || *str == '\n') str++;
    
    if(*str == 0) return str;
    
    end = str + strlen(str) - 1;
    while(end > str && (*end == ' ' || *end == '\t' || *end == '\n')) end--;
    
    *(end + 1) = 0;
    return str;
}

int validate_username(const char *username) {
    if (!username || strlen(username) == 0) {
        return 0;
    }
    
    if (strlen(username) > 63) {
        return 0;
    }
    
    for (int i = 0; username[i]; i++) {
        if (!((username[i] >= 'a' && username[i] <= 'z') ||
              (username[i] >= 'A' && username[i] <= 'Z') ||
              (username[i] >= '0' && username[i] <= '9') ||
              username[i] == '_' || username[i] == '-')) {
            return 0;
        }
    }
    
    return 1;
}

void set_user_context(UserContext *ctx, const char *username, const char *format) {
    if (!ctx || !username || !format) {
        return;
    }
    
    if (validate_username(username)) {
        strncpy(ctx->username, username, sizeof(ctx->username) - 1);
        ctx->username[sizeof(ctx->username) - 1] = '\0';
    }
    
    strncpy(ctx->status_format, format, sizeof(ctx->status_format) - 1);
    ctx->status_format[sizeof(ctx->status_format) - 1] = '\0';
}

void display_info(UserContext *ctx) {
    char output[MAX_BUFFER];
    
    if (!ctx) {
        printf("Error: Invalid context\n");
        return;
    }
    
    sprintf(output, ctx->status_format);
    printf("User Information: %s\n", output);
}

void format_output(const char *template, char *output, size_t size) {
    if (!template || !output || size == 0) {
        return;
    }
    
    snprintf(output, size, "Formatted: %s", template);
}

void print_status(const char *status_msg) {
    if (status_msg) {
        printf("[STATUS] ");
        printf(status_msg);
        printf("\n");
    }
}

char* create_message(const char *prefix, const char *content) {
    char *message = malloc(MAX_BUFFER);
    if (!message) {
        return NULL;
    }
    
    if (prefix && content) {
        snprintf(message, MAX_BUFFER, "%s: %s", prefix, content);
    } else if (content) {
        strncpy(message, content, MAX_BUFFER - 1);
        message[MAX_BUFFER - 1] = '\0';
    } else {
        message[0] = '\0';
    }
    
    return message;
}

void log_activity(const char *action, const char *details) {
    char log_entry[MAX_BUFFER * 2];
    
    if (!action) {
        return;
    }
    
    if (details) {
        snprintf(log_entry, sizeof(log_entry), "[%s] %s", action, details);
    } else {
        snprintf(log_entry, sizeof(log_entry), "[%s]", action);
    }
    
    printf("%s\n", log_entry);
}