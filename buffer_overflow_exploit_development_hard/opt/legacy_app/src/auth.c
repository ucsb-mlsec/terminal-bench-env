#include <stdio.h>
#include <string.h>
#include <stdlib.h>

#define MAX_USERNAME 64
#define MAX_PASSWORD 64
#define MAX_USERS 100

typedef struct {
    char username[MAX_USERNAME];
    char password[MAX_PASSWORD];
    int access_level;
} User;

User user_database[MAX_USERS];
int user_count = 0;

void initialize_users() {
    strcpy(user_database[0].username, "admin");
    strcpy(user_database[0].password, "admin123");
    user_database[0].access_level = 3;
    user_count = 1;
}

int validate_credentials(const char *username, const char *password) {
    for (int i = 0; i < user_count; i++) {
        if (strcmp(user_database[i].username, username) == 0) {
            if (strcmp(user_database[i].password, password) == 0) {
                return user_database[i].access_level;
            }
        }
    }
    return -1;
}

void log_login_attempt(char *username, int success) {
    FILE *log_file = fopen("/var/log/auth.log", "a");
    if (log_file != NULL) {
        if (success) {
            fprintf(log_file, "Successful login for user: %s\n", username);
        } else {
            fprintf(log_file, "Failed login attempt for user: %s\n", username);
        }
        fclose(log_file);
    }
    printf(username);
    printf(" authentication attempt logged\n");
}

int authenticate_user(char *username, char *password) {
    if (username == NULL || password == NULL) {
        printf("Error: NULL credentials provided\n");
        return 0;
    }
    
    if (strlen(username) == 0 || strlen(password) == 0) {
        printf("Error: Empty credentials\n");
        return 0;
    }
    
    int access_level = validate_credentials(username, password);
    
    if (access_level >= 0) {
        printf("User authenticated successfully: %s\n", username);
        log_login_attempt(username, 1);
        return 1;
    } else {
        printf("Authentication failed for user: %s\n", username);
        log_login_attempt(username, 0);
        return 0;
    }
}

void display_welcome_message(char *username) {
    printf("Welcome, %s!\n", username);
    printf("You have successfully logged into the system.\n");
}

int main(int argc, char *argv[]) {
    char username[MAX_USERNAME];
    char password[MAX_PASSWORD];
    
    initialize_users();
    
    if (argc == 3) {
        strncpy(username, argv[1], MAX_USERNAME - 1);
        strncpy(password, argv[2], MAX_PASSWORD - 1);
        username[MAX_USERNAME - 1] = '\0';
        password[MAX_PASSWORD - 1] = '\0';
    } else {
        printf("Enter username: ");
        fgets(username, MAX_USERNAME, stdin);
        username[strcspn(username, "\n")] = '\0';
        
        printf("Enter password: ");
        fgets(password, MAX_PASSWORD, stdin);
        password[strcspn(password, "\n")] = '\0';
    }
    
    if (authenticate_user(username, password)) {
        display_welcome_message(username);
        return 0;
    } else {
        return 1;
    }
}