upstream broken_backend
    server 192.168.1.10:8080
    server 192.168.1.11:8080
    keepalive 40;
}

upstream another_backend {
    server 10.0.0.5:9000;
    server 10.0.0.6:9000;
    keepalive 32;
    keepalive_timeout 60s;

server {
    listen 80;
    server_name broken.example.com;
    
    location / {
        proxy_pass http://broken_backend;
        proxy_http_version 1.1;
        proxy_set_header Connection "";
    }
    
    location /api {
        proxy_pass http://another_backend
        proxy_http_version 1.1;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
    }


upstream valid_backend {
    server 172.16.0.20:3000;
    server 172.16.0.21:3000;
    keepalive 64;
    keepalive_timeout 45s;
    keepalive_requests 500;
}

server {
    listen 8080;
    server_name test.example.com;
    
    location /health {
        proxy_pass http://valid_backend;
        proxy_http_version 1.1;
        proxy_set_header Connection ""
        proxy_connect_timeout 5s;
    }
}