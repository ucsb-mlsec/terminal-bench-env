2024-01-15 14:28:12 ERROR Executor: Exception in task 234.0 in stage 5.0 (TID 1456)
2024-01-15 14:28:12 ERROR Executor: Executor ID: 8, Host: worker-node-07
2024-01-15 14:28:12 ERROR Executor: Container running beyond memory limits. Current usage: 15.8 GB of 16 GB physical memory used
2024-01-15 14:28:13 WARN TaskSetManager: Lost task 234.0 in stage 5.0 (TID 1456, worker-node-07, executor 8): java.lang.OutOfMemoryError: GC overhead limit exceeded
	at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage5.agg_doAggregateWithKeys_0$(Unknown Source)
	at org.apache.spark.sql.execution.aggregate.HashAggregateExec.doExecute(HashAggregateExec.scala:845)
	at org.apache.spark.sql.execution.ShuffleExchangeExec.prepareShuffleDependency(ShuffleExchangeExec.scala:366)
	at org.apache.spark.sql.execution.ShuffleExchangeExec.$anonfun$doExecute$1(ShuffleExchangeExec.scala:131)
	at org.apache.spark.sql.catalyst.errors.package$.attachTree(package.scala:52)
	at org.apache.spark.sql.execution.exchange.ShuffleExchangeExec.doExecute(ShuffleExchangeExec.scala:127)
	at org.apache.spark.sql.execution.SparkPlan.$anonfun$execute$1(SparkPlan.scala:180)
	at org.apache.spark.sql.execution.aggregate.HashAggregateExec.finishAggregate(HashAggregateExec.scala:523)

2024-01-15 14:28:13 ERROR Executor: Memory pressure detected during shuffle write operation
2024-01-15 14:28:13 ERROR Executor: GC taking 98.7% of execution time
2024-01-15 14:28:13 ERROR Executor: Less than 1.4% of heap recovered after full GC cycle
2024-01-15 14:28:13 ERROR Executor: Used heap: 7.9GB / 8.0GB (98.75%)
2024-01-15 14:28:13 ERROR Executor: Off-heap memory: 1.2GB / 1.5GB (80%)

2024-01-15 14:28:13 INFO MemoryStore: Memory usage statistics:
2024-01-15 14:28:13 INFO MemoryStore: Storage memory: 2.1GB (StorageMemoryPool)
2024-01-15 14:28:13 INFO MemoryStore: Execution memory: 5.8GB (ExecutionMemoryPool)
2024-01-15 14:28:13 INFO MemoryStore: Spill threshold exceeded 47 times in last 10 minutes

2024-01-15 14:28:14 WARN ShuffleBlockFetcherIterator: Failed to fetch shuffle block shuffle_5_234_0 from executor 8
2024-01-15 14:28:14 ERROR ShuffleExchangeExec: Shuffle write failed for partition 234
2024-01-15 14:28:14 ERROR ShuffleExchangeExec: Attempting to spill to disk, but insufficient memory to continue

2024-01-15 14:28:14 INFO TaskMetrics: Shuffle Metrics for task 1456:
2024-01-15 14:28:14 INFO TaskMetrics: Shuffle Write: 4.8 GB
2024-01-15 14:28:14 INFO TaskMetrics: Shuffle Read: 6.2 GB
2024-01-15 14:28:14 INFO TaskMetrics: Spill (memory): 8.3 GB
2024-01-15 14:28:14 INFO TaskMetrics: Spill (disk): 3.7 GB

2024-01-15 14:28:15 ERROR TaskSetManager: Task 234 in stage 5.0 failed 4 times; aborting job
2024-01-15 14:28:15 ERROR Executor: Stage 5.0 contains aggregate operations with high cardinality
2024-01-15 14:28:15 ERROR Executor: Distinct key count estimated at 45M for groupBy operation
2024-01-15 14:28:15 ERROR Executor: Hash map size exceeds available memory in aggregation buffer

2024-01-15 14:28:15 WARN BlockManager: Block rdd_234_8 dropped from memory due to memory pressure
2024-01-15 14:28:15 WARN BlockManager: Not enough space to cache rdd_234_8 in memory (size: 1.2 GB, free: 0.1 GB)

2024-01-15 14:28:16 ERROR Executor: Full GC (Allocation Failure) 7904M->7876M(8192M), 4.823 secs
2024-01-15 14:28:16 ERROR Executor: Full GC (Allocation Failure) 7876M->7881M(8192M), 4.956 secs
2024-01-15 14:28:16 ERROR Executor: Full GC (Ergonomics) 7881M->7879M(8192M), 5.102 secs

2024-01-15 14:28:17 WARN TaskMemoryManager: Failed to allocate 134217728 bytes for org.apache.spark.util.collection.unsafe.sort.UnsafeExternalSorter
2024-01-15 14:28:17 ERROR UnsafeExternalSorter: Unable to grow in-memory sorter for shuffle operations

2024-01-15 14:28:17 INFO DAGScheduler: Stage 5 (aggregate at transaction_aggregator.py:87) failed in 342.156 s due to OOM in executor 8
2024-01-15 14:28:17 INFO DAGScheduler: Job 2 failed: aggregate operation exceeded memory limits
2024-01-15 14:28:17 ERROR TaskSchedulerImpl: Executor 8 on worker-node-07 lost due to repeated OOM failures

2024-01-15 14:28:18 ERROR Executor: Current shuffle partitions: 200
2024-01-15 14:28:18 ERROR Executor: Average partition size: 3.2 GB (exceeds recommended 200 MB)
2024-01-15 14:28:18 ERROR Executor: Executor memory overhead: 1.5 GB
2024-01-15 14:28:18 ERROR Executor: Total executor memory allocated: 10 GB (executor.memory: 8 GB + overhead: 2 GB)

2024-01-15 14:28:18 WARN HeartbeatReceiver: Removing executor 8 with no recent heartbeats: 125000 ms exceeds timeout 120000 ms
2024-01-15 14:28:18 ERROR SparkContext: Job aborted due to stage failure: Task 234 in stage 5.0 failed 4 times
2024-01-15 14:28:18 ERROR ApplicationMaster: Final app status: FAILED, exitCode: 1, (reason: Executor failures exceeded threshold)