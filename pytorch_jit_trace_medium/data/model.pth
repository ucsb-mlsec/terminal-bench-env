import torch
import torch.nn as nn
import os

# Create the data directory if it doesn't exist
os.makedirs('data', exist_ok=True)

# Define the model architecture
model = nn.Sequential(
    nn.Conv2d(3, 32, 3, padding=1),
    nn.ReLU(),
    nn.MaxPool2d(2, 2),
    nn.Conv2d(32, 64, 3, padding=1),
    nn.ReLU(),
    nn.MaxPool2d(2, 2),
    nn.Conv2d(64, 128, 3, padding=1),
    nn.ReLU(),
    nn.MaxPool2d(2, 2),
    nn.Flatten(),
    nn.Linear(128*28*28, 512),
    nn.ReLU(),
    nn.Linear(512, 10)
)

# Initialize with random weights for consistency
torch.manual_seed(42)
for layer in model.modules():
    if isinstance(layer, (nn.Conv2d, nn.Linear)):
        nn.init.xavier_uniform_(layer.weight)
        if layer.bias is not None:
            nn.init.zeros_(layer.bias)

# Save the state dictionary
torch.save(model.state_dict(), 'data/model.pth')

# Also create a sample input for testing
sample_input = torch.randn(1, 3, 224, 224)
torch.save(sample_input, 'data/sample_input.pt')

print("Model state dictionary and sample input created successfully!")