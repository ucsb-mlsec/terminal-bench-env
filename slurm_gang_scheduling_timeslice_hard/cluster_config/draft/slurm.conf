# SLURM Configuration File - Research Computing Facility
# Draft version - Gang Scheduling Setup

ClusterName=research-cluster
SlurmctldHost=head-node
SlurmUser=slurm
SlurmdUser=root

# State preservation
StateSaveLocation=/var/spool/slurm/ctld
SlurmdSpoolDir=/var/spool/slurm/d
SlurmctldPidFile=/var/run/slurmctld.pid
SlurmdPidFile=/var/run/slurmd.pid

# Logging
SlurmctldLogFile=/var/log/slurm/slurmctld.log
SlurmdLogFile=/var/log/slurm/slurmd.log

# Scheduler Configuration - INCORRECT FOR GANG SCHEDULING
SchedulerType=sched/backfill
SchedulerTimeSlice=5
SchedulerParameters=default_queue_depth=100

# Process tracking
ProctrackType=proctrack/linuxproc

# Resource selection
SelectType=select/cons_tres
SelectTypeParameters=CR_Core_Memory

# Preemption settings - INCOMPATIBLE WITH GANG SCHEDULING
PreemptType=preempt/partition_prio
PreemptMode=CANCEL
PreemptExemptTime=00:05:00

# Job priority
PriorityType=priority/multifactor
PriorityDecayHalfLife=7-0
PriorityMaxAge=14-0
PriorityWeightAge=1000
PriorityWeightFairshare=10000
PriorityWeightJobSize=500
PriorityWeightPartition=1000
PriorityWeightQOS=2000

# Node failure handling
ReturnToService=2
HealthCheckInterval=300

# Job and step limits
MaxJobCount=10000
MaxStepCount=40000
MaxTasksPerNode=128

# Timeout values
MessageTimeout=60
SlurmctldTimeout=300
SlurmdTimeout=300
InactiveLimit=0
MinJobAge=300
KillWait=30
Waittime=0

# Completion and accounting
JobCompType=jobcomp/none
JobAcctGatherType=jobacct_gather/linux
JobAcctGatherFrequency=30

# Network and communication
SlurmctldPort=6817
SlurmdPort=6818

# Wrong configuration that conflicts with timeslicing
OverTimeLimit=120
DefMemPerCPU=2048
MaxMemPerCPU=8192

# Include partition and node configurations
Include /cluster_config/draft/partitions.conf
Include /cluster_config/draft/nodes.conf