package com.example;

import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import java.util.HashMap;
import java.util.Map;

/**
 * UserService class handles user management operations
 * including creation, retrieval, and deletion of user records.
 * 
 * @author Development Team
 * @version 1.0
 */
public class UserService {
    
    private static final Logger logger = LogManager.getLogger(UserService.class);
    private Map<String, User> userDatabase = new HashMap<>();
    
    /**
     * Creates a new user in the system
     * 
     * @param userId Unique identifier for the user
     * @param username Username for the account
     * @param email User's email address
     * @return boolean indicating success or failure
     */
    public boolean createUser(String userId, String username, String email) {
        logger.info("Attempting to create user with ID: {}", userId);
        
        try {
            if (userDatabase.containsKey(userId)) {
                logger.error("User creation failed - User ID already exists: {}", userId);
                return false;
            }
            
            User newUser = new User(userId, username, email);
            userDatabase.put(userId, newUser);
            logger.info("Successfully created user: {} with email: {}", username, email);
            return true;
            
        } catch (Exception e) {
            logger.error("Error creating user: {}", e.getMessage());
            return false;
        }
    }
    
    /**
     * Retrieves user information by user ID
     * 
     * @param userId The unique identifier of the user to retrieve
     * @return User object if found, null otherwise
     */
    public User getUserById(String userId) {
        logger.debug("Fetching user with ID: {}", userId);
        
        if (userId == null || userId.isEmpty()) {
            logger.error("Invalid user ID provided: null or empty");
            return null;
        }
        
        User user = userDatabase.get(userId);
        if (user != null) {
            logger.info("User found: {}", user.getUsername());
        } else {
            logger.debug("No user found with ID: {}", userId);
        }
        
        return user;
    }
    
    /**
     * Deletes a user from the system
     * 
     * @param userId The unique identifier of the user to delete
     * @return boolean indicating whether deletion was successful
     */
    public boolean deleteUser(String userId) {
        logger.info("Attempting to delete user with ID: {}", userId);
        
        if (!userDatabase.containsKey(userId)) {
            logger.error("Cannot delete user - User ID not found: {}", userId);
            return false;
        }
        
        User removedUser = userDatabase.remove(userId);
        logger.info("Successfully deleted user: {}", removedUser.getUsername());
        return true;
    }
    
    /**
     * Updates user email address
     * 
     * @param userId The user ID to update
     * @param newEmail The new email address
     * @return boolean indicating success
     */
    public boolean updateUserEmail(String userId, String newEmail) {
        logger.debug("Updating email for user ID: {}", userId);
        
        User user = userDatabase.get(userId);
        if (user == null) {
            logger.error("Update failed - User not found: {}", userId);
            return false;
        }
        
        user.setEmail(newEmail);
        logger.info("Updated email for user: {} to: {}", user.getUsername(), newEmail);
        return true;
    }
}