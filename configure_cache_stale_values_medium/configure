#!/bin/sh
# Configure script generated by GNU Autoconf
# Simple configure script for myapp database utility

# Configuration cache file
cache_file=config.cache

# Default variables
PACKAGE_NAME='myapp'
PACKAGE_VERSION='1.0'
prefix=/usr/local
exec_prefix='${prefix}'
bindir='${exec_prefix}/bin'

# Compiler defaults
CC=${CC:-cc}
CFLAGS=${CFLAGS:--g -O2}
LDFLAGS=${LDFLAGS:-}
LIBS=
CPPFLAGS=${CPPFLAGS:-}

# Paths that might contain headers/libraries
sqlite_found=no
SQLITE_CFLAGS=
SQLITE_LIBS=

# Parse command line arguments
for ac_option
do
  case $ac_option in
  --prefix=*)
    prefix=`echo $ac_option | sed 's/--prefix=//'`
    ;;
  --exec-prefix=*)
    exec_prefix=`echo $ac_option | sed 's/--exec-prefix=//'`
    ;;
  --bindir=*)
    bindir=`echo $ac_option | sed 's/--bindir=//'`
    ;;
  -C | --cache-file | --cache-file=*)
    ;;
  --help | -h)
    cat <<EOF
Configuration:
  --help                  display this help and exit
  --cache-file=FILE       cache test results in FILE
  -C                      alias for --cache-file=config.cache
  --prefix=PREFIX         install architecture-independent files in PREFIX
  --exec-prefix=EPREFIX   install architecture-dependent files in EPREFIX
  --bindir=DIR            user executables [EPREFIX/bin]

Some influential environment variables:
  CC          C compiler command
  CFLAGS      C compiler flags
  LDFLAGS     linker flags
  CPPFLAGS    C preprocessor flags
EOF
    exit 0
    ;;
  esac
done

# Load cache file if it exists
if test -f "$cache_file"; then
  echo "loading cache $cache_file"
  . ./$cache_file
fi

# Start configuration
echo "checking for a C compiler..."
if test -z "$CC"; then
  for ac_prog in gcc cc clang
  do
    ac_path=`which $ac_prog 2>/dev/null`
    if test -n "$ac_path"; then
      CC=$ac_prog
      break
    fi
  done
fi

if test -z "$CC"; then
  echo "error: no C compiler found"
  exit 1
fi

echo "checking whether $CC works..."
cat > conftest.c <<EOF
int main() { return 0; }
EOF

if $CC $CFLAGS conftest.c -o conftest 2>/dev/null; then
  echo "yes"
  rm -f conftest conftest.c conftest.o
else
  echo "no"
  echo "error: C compiler cannot create executables"
  rm -f conftest.c
  exit 1
fi

# Function to check for header files
ac_check_header() {
  ac_header=$1
  echo "checking for $ac_header..."
  
  cat > conftest.c <<EOF
#include <$ac_header>
int main() { return 0; }
EOF
  
  if $CC $CPPFLAGS $CFLAGS -c conftest.c -o conftest.o 2>/dev/null; then
    rm -f conftest.c conftest.o
    return 0
  else
    rm -f conftest.c conftest.o
    return 1
  fi
}

# Function to check for library functions
ac_check_lib() {
  ac_lib=$1
  ac_func=$2
  echo "checking for $ac_func in -l$ac_lib..."
  
  cat > conftest.c <<EOF
char $ac_func();
int main() {
  $ac_func();
  return 0;
}
EOF
  
  if $CC $CFLAGS $LDFLAGS conftest.c -l$ac_lib -o conftest 2>/dev/null; then
    rm -f conftest conftest.c
    return 0
  else
    rm -f conftest conftest.c
    return 1
  fi
}

# Check for standard headers
echo "checking for standard headers..."
ac_check_header stdio.h
ac_check_header stdlib.h
ac_check_header string.h

# Check for SQLite3 header with cached value
echo "checking for sqlite3.h..."
if test "${ac_cv_header_sqlite3_h+set}" = set; then
  echo "  (cached) $ac_cv_header_sqlite3_h"
  if test "$ac_cv_header_sqlite3_h" = yes; then
    sqlite_header_found=yes
  else
    sqlite_header_found=no
  fi
else
  # Search in various locations
  sqlite_header_found=no
  for ac_dir in /usr/include /usr/local/include /opt/local/include /opt/custom/sqlite3/include
  do
    if test -f "$ac_dir/sqlite3.h"; then
      sqlite_header_found=yes
      SQLITE_HEADER_PATH=$ac_dir
      if test "$ac_dir" != "/usr/include"; then
        SQLITE_CFLAGS="-I$ac_dir"
      fi
      break
    fi
  done
  
  if test "$sqlite_header_found" = yes; then
    echo "  found in $SQLITE_HEADER_PATH"
    ac_cv_header_sqlite3_h=yes
  else
    echo "  not found"
    ac_cv_header_sqlite3_h=no
  fi
fi

# Check for SQLite3 library with cached value
echo "checking for sqlite3_open in -lsqlite3..."
if test "${ac_cv_lib_sqlite3_sqlite3_open+set}" = set; then
  echo "  (cached) $ac_cv_lib_sqlite3_sqlite3_open"
  if test "$ac_cv_lib_sqlite3_sqlite3_open" = yes; then
    sqlite_lib_found=yes
  else
    sqlite_lib_found=no
  fi
else
  sqlite_lib_found=no
  
  # Try standard library search first
  cat > conftest.c <<EOF
char sqlite3_open();
int main() {
  sqlite3_open();
  return 0;
}
EOF
  
  # Search in various library paths
  for ac_libdir in "" /usr/lib /usr/local/lib /opt/local/lib /opt/custom/sqlite3/lib /usr/lib/x86_64-linux-gnu
  do
    if test -z "$ac_libdir"; then
      test_ldflags=""
    else
      test_ldflags="-L$ac_libdir"
    fi
    
    if $CC $CFLAGS $LDFLAGS $test_ldflags conftest.c -lsqlite3 -o conftest 2>/dev/null; then
      sqlite_lib_found=yes
      SQLITE_LIB_PATH=$ac_libdir
      if test -n "$ac_libdir"; then
        SQLITE_LDFLAGS="-L$ac_libdir"
      fi
      SQLITE_LIBS="-lsqlite3"
      break
    fi
  done
  
  rm -f conftest conftest.c
  
  if test "$sqlite_lib_found" = yes; then
    echo "  yes"
    ac_cv_lib_sqlite3_sqlite3_open=yes
  else
    echo "  no"
    ac_cv_lib_sqlite3_sqlite3_open=no
  fi
fi

# Final check for SQLite3
if test "$sqlite_header_found" != yes -o "$sqlite_lib_found" != yes; then
  echo ""
  echo "error: SQLite3 library not found"
  echo "Please install SQLite3 development packages"
  exit 1
fi

# Set final compiler flags
CPPFLAGS="$CPPFLAGS $SQLITE_CFLAGS"
LDFLAGS="$LDFLAGS $SQLITE_LDFLAGS"
LIBS="$LIBS $SQLITE_LIBS"

# Save cache
echo "creating $cache_file"
cat > $cache_file <<EOF
# Configuration cache file
ac_cv_header_sqlite3_h=$ac_cv_header_sqlite3_h
ac_cv_lib_sqlite3_sqlite3_open=$ac_cv_lib_sqlite3_sqlite3_open
EOF

# Generate Makefile
echo "creating Makefile"
sed -e "s|@CC@|$CC|g" \
    -e "s|@CFLAGS@|$CFLAGS|g" \
    -e "s|@CPPFLAGS@|$CPPFLAGS|g" \
    -e "s|@LDFLAGS@|$LDFLAGS|g" \
    -e "s|@LIBS@|$LIBS|g" \
    -e "s|@prefix@|$prefix|g" \
    -e "s|@exec_prefix@|$exec_prefix|g" \
    -e "s|@bindir@|$bindir|g" \
    Makefile.in > Makefile

# Generate config.log
echo "Configuration summary:" > config.log
echo "  C compiler: $CC" >> config.log
echo "  CFLAGS: $CFLAGS" >> config.log
echo "  CPPFLAGS: $CPPFLAGS" >> config.log
echo "  LDFLAGS: $LDFLAGS" >> config.log
echo "  LIBS: $LIBS" >> config.log
echo "  SQLite3 header: $SQLITE_HEADER_PATH/sqlite3.h" >> config.log
echo "  SQLite3 library: $SQLITE_LIB_PATH" >> config.log

echo ""
echo "Configuration complete."
echo "  SQLite3 header found: $SQLITE_HEADER_PATH/sqlite3.h"
echo "  SQLite3 library found: yes"
echo ""
echo "Now run 'make' to build the project."