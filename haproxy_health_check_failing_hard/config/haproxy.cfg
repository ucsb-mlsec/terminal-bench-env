global
    log /dev/log local0
    log /dev/log local1 notice
    maxconn 4096
    user haproxy
    group haproxy
    daemon
    stats socket /var/run/haproxy.sock mode 600 level admin
    stats timeout 2m

defaults
    log global
    mode http
    option httplog
    option dontlognull
    timeout connect 1000ms
    timeout client 2000ms
    timeout server 2000ms
    timeout check 500ms
    retries 2
    option redispatch

frontend web_frontend
    bind *:80
    default_backend web_servers
    option forwardfor
    option http-server-close

backend web_servers
    balance roundrobin
    option httpchk GET /health
    http-check expect status 200
    default-server inter 2s rise 1 fall 1
    server web1 192.168.1.101:8080 check
    server web2 192.168.1.102:8080 check
    server web3 192.168.1.103:8080 check
    server web4 192.168.1.104:8080 check