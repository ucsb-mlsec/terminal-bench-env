#!/usr/bin/env python3

from flask import Flask, render_template_string, request
import os

# Set the secret flag in environment variable
os.environ['SECRET_FLAG'] = 'FLAG{t3mpl4t3_1nj3ct10n_vuln3r4b1l1ty_2024}'

app = Flask(__name__)

# Basic blacklist filter (can be bypassed)
BLACKLIST = ['config', 'class', 'mro', 'import', 'os', 'subprocess']

def basic_filter(user_input):
    """Basic filtering that can be bypassed"""
    for word in BLACKLIST:
        if word.lower() in user_input.lower():
            return None
    return user_input

@app.route('/', methods=['GET', 'POST'])
def index():
    if request.method == 'POST':
        user_input = request.form.get('message', '')
        
        # Apply basic filtering
        filtered_input = basic_filter(user_input)
        
        if filtered_input is None:
            return render_template_string('''
                <html>
                <head><title>Message Board</title></head>
                <body>
                    <h1>Welcome to Our Message Board</h1>
                    <p style="color: red;">Invalid input detected! Prohibited keywords found.</p>
                    <a href="/">Go back</a>
                </body>
                </html>
            ''')
        
        # Vulnerable template rendering
        template = '''
            <html>
            <head><title>Message Board</title></head>
            <body>
                <h1>Welcome to Our Message Board</h1>
                <p>Your message: ''' + filtered_input + '''</p>
                <br>
                <a href="/">Submit another message</a>
            </body>
            </html>
        '''
        return render_template_string(template)
    
    # GET request - show form
    return render_template_string('''
        <html>
        <head><title>Message Board</title></head>
        <body>
            <h1>Welcome to Our Message Board</h1>
            <p>Please enter your message below:</p>
            <form method="POST">
                <input type="text" name="message" size="50" placeholder="Enter your message here">
                <br><br>
                <input type="submit" value="Submit">
            </form>
        </body>
        </html>
    ''')

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000, debug=True)