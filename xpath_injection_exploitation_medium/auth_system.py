#!/usr/bin/env python3

from lxml import etree

def authenticate(username, password):
    """
    Vulnerable authentication function that uses XPath injection.
    DO NOT USE IN PRODUCTION - This is intentionally vulnerable for demonstration.
    """
    try:
        # Load XML database
        tree = etree.parse('/home/user/users.xml')
        
        # Vulnerable XPath query - directly concatenating user input
        xpath_query = f"//user[username='{username}' and password='{password}']"
        
        # Execute the query
        result = tree.xpath(xpath_query)
        
        # Return True if any matching users found
        if result:
            return True
        else:
            return False
    except Exception as e:
        print(f"Error during authentication: {e}")
        return False

def check_credentials(username, password):
    """
    Alternative vulnerable function name - same vulnerability
    """
    return authenticate(username, password)

if __name__ == "__main__":
    # Example usage
    print("Authentication System (Vulnerable Demo)")
    print("-" * 40)
    
    # Test with normal credentials
    result = authenticate("admin", "password123")
    print(f"Normal login attempt: {result}")
    
    # Example of potential injection
    result = authenticate("admin' or '1'='1", "anything")
    print(f"Injection attempt: {result}")