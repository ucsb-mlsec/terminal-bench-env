#include <stdio.h>
#include <string.h>
#include <stdlib.h>

#define SECRET_PASSWORD "admin123"

int authenticate(char *username) {
    char password[64];
    int authenticated = 0;
    
    printf("=== Legacy Authentication Service ===\n");
    printf("Username: %s\n", username);
    printf("Enter password: ");
    
    // Vulnerable: gets() does not perform bounds checking
    gets(password);
    
    // Simple authentication check
    if (strcmp(password, SECRET_PASSWORD) == 0) {
        authenticated = 1;
        printf("\n[+] Authentication successful!\n");
        printf("[+] Access granted for user: %s\n", username);
    } else {
        printf("\n[-] Authentication failed!\n");
        printf("[-] Access denied for user: %s\n", username);
    }
    
    return authenticated;
}

void admin_shell() {
    printf("\n[*] ADMIN SHELL ACTIVATED [*]\n");
    printf("[*] Welcome to the administrative interface\n");
    printf("[*] This function should never be called directly!\n");
    system("/bin/sh");
}

int main(int argc, char *argv[]) {
    char username[32];
    int result;
    
    printf("=================================\n");
    printf("  Secure Auth Service v1.0\n");
    printf("  (Legacy Edition)\n");
    printf("=================================\n\n");
    
    if (argc > 1) {
        strncpy(username, argv[1], sizeof(username) - 1);
        username[sizeof(username) - 1] = '\0';
    } else {
        strcpy(username, "guest");
    }
    
    result = authenticate(username);
    
    if (result) {
        printf("\n[+] Session established\n");
        return 0;
    } else {
        printf("\n[-] Session denied\n");
        return 1;
    }
}