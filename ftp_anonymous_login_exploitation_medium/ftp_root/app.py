#!/usr/bin/env python3

from flask import Flask, jsonify, request
import pymysql
import os
import json

app = Flask(__name__)

# Database configuration is loaded from external config files
# See config/db_config.json for database connection parameters

def load_database_config():
    """
    Load database configuration from external config file.
    This function reads the database credentials from config/db_config.json
    """
    config_path = os.path.join(os.path.dirname(__file__), 'config', 'db_config.json')
    try:
        with open(config_path, 'r') as config_file:
            db_config = json.load(config_file)
            return db_config
    except FileNotFoundError:
        print("Warning: Database config file not found")
        return None

def get_db_connection():
    """
    Establish database connection using loaded configuration
    """
    config = load_database_config()
    if config:
        connection = pymysql.connect(
            host=config.get('host'),
            user=config.get('user'),
            password=config.get('password'),
            database=config.get('database')
        )
        return connection
    return None

@app.route('/')
def index():
    """
    Homepage endpoint
    """
    return jsonify({
        'message': 'Welcome to the API',
        'version': '1.0',
        'endpoints': ['/api/users', '/api/data']
    })

@app.route('/api/users')
def get_users():
    """
    Retrieve users from database
    """
    return jsonify({
        'users': [
            {'id': 1, 'name': 'John Doe'},
            {'id': 2, 'name': 'Jane Smith'}
        ]
    })

@app.route('/api/data')
def get_data():
    """
    Retrieve application data
    """
    return jsonify({
        'data': 'Sample data from API',
        'status': 'active'
    })

if __name__ == '__main__':
    app.run(debug=True, host='0.0.0.0', port=5000)