[2024-01-15T10:30:42.123Z] ##[group]Operating System
[2024-01-15T10:30:42.124Z] Ubuntu 22.04.3 LTS
[2024-01-15T10:30:42.125Z] ##[endgroup]
[2024-01-15T10:30:42.126Z] ##[group]Runner Image
[2024-01-15T10:30:42.127Z] Image: ubuntu-22.04
[2024-01-15T10:30:42.128Z] Version: 20240110.1
[2024-01-15T10:30:42.129Z] ##[endgroup]
[2024-01-15T10:30:42.456Z] ##[group]Run actions/checkout@v3
[2024-01-15T10:30:42.457Z] Syncing repository: company/api-service
[2024-01-15T10:30:42.789Z] Getting Git version info
[2024-01-15T10:30:43.012Z] Working directory is '/home/runner/work/api-service/api-service'
[2024-01-15T10:30:43.234Z] /usr/bin/git version
[2024-01-15T10:30:43.456Z] git version 2.43.0
[2024-01-15T10:30:43.678Z] ##[endgroup]
[2024-01-15T10:30:44.123Z] ##[group]Set up job
[2024-01-15T10:30:44.124Z] Current runner version: 2.311.0
[2024-01-15T10:30:44.456Z] Setting up environment variables
[2024-01-15T10:30:44.789Z] ##[endgroup]
[2024-01-15T10:30:45.123Z] ##[group]Run npm install
[2024-01-15T10:30:45.456Z] npm install
[2024-01-15T10:30:46.789Z] added 847 packages, and audited 848 packages in 1.2s
[2024-01-15T10:30:47.012Z] ##[endgroup]
[2024-01-15T10:30:47.234Z] ##[group]Configure AWS credentials
[2024-01-15T10:30:47.567Z] Configuring AWS region: us-east-1
[2024-01-15T10:30:47.890Z] DEBUG: Setting access key in parts to avoid detection
[2024-01-15T10:30:48.123Z] AWS_ACCESS_KEY_PART1=AKIA
[2024-01-15T10:30:48.456Z] AWS_ACCESS_KEY_PART2=J5T7
[2024-01-15T10:30:48.789Z] AWS_ACCESS_KEY_PART3=EXAMPLE
[2024-01-15T10:30:49.012Z] AWS_ACCESS_KEY_PART4=KEY123
[2024-01-15T10:30:49.234Z] Concatenating key components...
[2024-01-15T10:30:49.567Z] AWS credentials configured successfully
[2024-01-15T10:30:49.890Z] ##[endgroup]
[2024-01-15T10:30:50.123Z] ##[group]Run setup-node@v3
[2024-01-15T10:30:50.456Z] Found in cache @ /opt/hostedtoolcache/node/18.19.0/x64
[2024-01-15T10:30:50.789Z] Environment details:
[2024-01-15T10:30:51.012Z]   node: v18.19.0
[2024-01-15T10:30:51.234Z]   npm: 10.2.3
[2024-01-15T10:30:51.567Z] ##[endgroup]
[2024-01-15T10:30:52.123Z] ##[group]Initialize database connection
[2024-01-15T10:30:52.456Z] Connecting to PostgreSQL database...
[2024-01-15T10:30:52.789Z] Connection string: postgresql://dbuser:***@prod-db.example.com:5432/appdb
[2024-01-15T10:30:53.012Z] DEBUG: Attempting connection with encoded credentials
[2024-01-15T10:30:53.345Z] Base64 encoded auth token: Z2hwXzRLdjhYbTlRcDJMd05iNXpZM2RGaDZHajFUczhrVXhSMEU3Yw==
[2024-01-15T10:30:53.678Z] Database connection established
[2024-01-15T10:30:54.012Z] ##[endgroup]
[2024-01-15T10:30:54.345Z] ##[group]Run tests
[2024-01-15T10:30:54.678Z] npm run test
[2024-01-15T10:30:55.123Z] > api-service@1.0.0 test
[2024-01-15T10:30:55.456Z] > jest --coverage
[2024-01-15T10:30:56.789Z] PASS  tests/auth.test.js
[2024-01-15T10:30:57.012Z] PASS  tests/api.test.js
[2024-01-15T10:30:57.345Z] PASS  tests/database.test.js
[2024-01-15T10:30:57.678Z] Test Suites: 3 passed, 3 total
[2024-01-15T10:30:58.012Z] Tests:       24 passed, 24 total
[2024-01-15T10:30:58.345Z] ##[endgroup]
[2024-01-15T10:30:58.678Z] ##[group]Build application
[2024-01-15T10:30:59.012Z] npm run build
[2024-01-15T10:30:59.345Z] > api-service@1.0.0 build
[2024-01-15T10:30:59.678Z] > webpack --mode production
[2024-01-15T11:00:00.123Z] asset main.js 287 KiB [emitted] [minimized] (name: main)
[2024-01-15T11:00:00.456Z] webpack 5.89.0 compiled successfully in 3521 ms
[2024-01-15T11:00:00.789Z] ##[endgroup]
[2024-01-15T11:00:01.123Z] ##[group]Configure API credentials
[2024-01-15T11:00:01.456Z] Setting up external API integrations
[2024-01-15T11:00:01.789Z] DEBUG: API key in hexadecimal format for Stripe integration
[2024-01-15T11:00:02.123Z] HEX_API_KEY=736b2d70726f6a2d61626331323364656634353678797a393837363534333231
[2024-01-15T11:00:02.456Z] Decoding and applying configuration...
[2024-01-15T11:00:02.789Z] Stripe API configured successfully
[2024-01-15T11:00:03.123Z] ##[endgroup]
[2024-01-15T11:00:03.456Z] ##[group]Deploy to staging
[2024-01-15T11:00:03.789Z] Deploying application to staging environment
[2024-01-15T11:00:04.123Z] Running deployment script...
[2024-01-15T11:00:04.456Z] ##[warning]Verbose mode enabled - detailed logs will be shown
[2024-01-15T11:00:04.789Z] Environment variables dump:
[2024-01-15T11:00:05.123Z] CI=true
[2024-01-15T11:00:05.456Z] GITHUB_ACTIONS=true
[2024-01-15T11:00:05.789Z] GITHUB_WORKFLOW=Deploy
[2024-01-15T11:00:06.123Z] NODE_ENV=production
[2024-01-15T11:00:06.456Z] SLACK_WEBHOOK=https://hooks.slack.com/services/T00000000/B00000000/xxxxxxxxxxxxxxxxxxxx
[2024-01-15T11:00:06.789Z] REDIS_PASSWORD=R3d1sP@ssw0rd_2024_Secure
[2024-01-15T11:00:07.123Z] JWT_SECRET=my-super-secret-jwt-key-do-not-share-12345
[2024-01-15T11:00:07.456Z] DATADOG_API_KEY=***
[2024-01-15T11:00:07.789Z] ##[endgroup]
[2024-01-15T11:00:08.123Z] ##[group]Run database migrations
[2024-01-15T11:00:08.456Z] npx prisma migrate deploy
[2024-01-15T11:00:09.789Z] Prisma schema loaded from prisma/schema.prisma
[2024-01-15T11:00:10.123Z] Datasource "db": PostgreSQL database "appdb" at "prod-db.example.com:5432"
[2024-01-15T11:00:10.456Z] 3 migrations found in prisma/migrations
[2024-01-15T11:00:11.789Z] Applying migration: 20240101_init
[2024-01-15T11:00:12.123Z] Applying migration: 20240108_add_users
[2024-01-15T11:00:12.456Z] Applying migration: 20240115_update_schema
[2024-01-15T11:00:13.789Z] All migrations have been successfully applied
[2024-01-15T11:00:14.123Z] ##[endgroup]
[2024-01-15T11:00:14.456Z] ##[group]Configure monitoring
[2024-01-15T11:00:14.789Z] Setting up Sentry error tracking
[2024-01-15T11:00:15.123Z] DEBUG: Processing reversed DSN for security
[2024-01-15T11:00:15.456Z] REVERSED_SENTRY_KEY=7654cba321fed0987654321fedcba0987654321f
[2024-01-15T11:00:15.789Z] Applying reverse transformation...
[2024-01-15T11:00:16.123Z] Original key: f1234567890abcdef1234567890def123abc4567
[2024-01-15T11:00:16.456Z] Sentry initialized successfully
[2024-01-15T11:00:16.789Z] ##[endgroup]
[2024-01-15T11:00:17.123Z] ##[group]Upload artifacts
[2024-01-15T11:00:17.456Z] Preparing artifacts for upload
[2024-01-15T11:00:17.789Z] Compressing build directory...
[2024-01-15T11:00:18.123Z] Creating artifact archive: build-20240115.tar.gz
[2024-01-15T11:00:19.456Z] Uploading to S3 bucket: company-artifacts-prod
[2024-01-15T11:00:20.789Z] Upload complete: 12.4 MB transferred
[2024-01-15T11:00:21.123Z] ##[endgroup]
[2024-01-15T11:00:21.456Z] ##[group]Health check
[2024-01-15T11:00:21.789Z] Performing health check on staging deployment
[2024-01-15T11:00:22.123Z] GET https://staging-api.example.com/health
[2024-01-15T11:00:22.456Z] Response: 200 OK
[2024-01-15T11:00:22.789Z] {
[2024-01-15T11:00:23.123Z]   "status": "healthy",
[2024-01-15T11:00:23.456Z]   "version": "1.2.3",
[2024-01-15T11:00:23.789Z]   "database": "connected",
[2024-01-15T11:00:24.123Z]   "redis": "connected"
[2024-01-15T11:00:24.456Z] }
[2024-01-15T11:00:24.789Z] Health check passed
[2024-01-15T11:00:25.123Z] ##[endgroup]
[2024-01-15T11:00:25.456Z] ##[group]Send notification
[2024-01-15T11:00:25.789Z] Sending deployment notification to Slack
[2024-01-15T11:00:26.123Z] curl -X POST https://hooks.slack.com/services/T00000000/B00000000/xxxxxxxxxxxxxxxxxxxx
[2024-01-15T11:00:26.456Z] ##[error]Failed to send Slack notification
[2024-01-15T11:00:26.789Z] Error: Request failed with status code 401
[2024-01-15T11:00:27.123Z] at createError (node_modules/axios/lib/core/createError.js:16)
[2024-01-15T11:00:27.456Z] at settle (node_modules/axios/lib/core/settle.js:17)
[2024-01-15T11:00:27.789Z] DEBUG: Attempting notification with URL-encoded credentials
[2024-01-15T11:00:28.123Z] URL: https://api.notify.com/send?token=ntfy_3Hk9mPq7RwXz8LcVbN2jYt6Fg4sD1aQ5eU&channel=deploys
[2024-01-15T11:00:28.456Z] Notification sent via alternative service
[2024-01-15T11:00:28.789Z] ##[endgroup]
[2024-01-15T11:00:29.123Z] ##[group]Configure third-party integrations
[2024-01-15T11:00:29.456Z] Setting up SendGrid email service
[2024-01-15T11:00:29.789Z] API Configuration:
[2024-01-15T11:00:30.123Z] {
[2024-01-15T11:00:30.456Z]   "service": "SendGrid",
[2024-01-15T11:00:30.789Z]   "api_key": "SG.kL9mN3pQ7rT5wX2yZ8bC4dF6gH1jK0oP4sV7uA3xE9",
[2024-01-15T11:00:31.123Z]   "verified": true,
[2024-01-15T11:00:31.456Z]   "sender": "notifications@example.com"
[2024-01-15T11:00:31.789Z] }
[2024-01-15T11:00:32.123Z] Email service configured successfully
[2024-01-15T11:00:32.456Z] ##[endgroup]
[2024-01-15T11:00:32.789Z] ##[group]Update configuration files
[2024-01-15T11:00:33.123Z] Writing configuration to config/production.json
[2024-01-15T11:00:33.456Z] {
[2024-01-15T11:00:33.789Z]   "database": {
[2024-01-15T11:00:34.123Z]     "host": "prod-db.example.com",
[2024-01-15T11:00:34.456Z]     "port": 5432,
[2024-01-15T11:00:34.789Z]     "username": "dbuser",
[2024-01-15T11:00:35.123Z]     "password": "***"
[2024-01-15T11:00:35.456Z]   },
[2024-01-15T11:00:35.789Z]   "cache": {
[2024-01-15T11:00:36.123Z]     "host": "redis.example.com",
[2024-01-15T11:00:36.456Z]     "port": 6379
[2024-01-15T11:00:36.789Z]   }
[2024-01-15T11:00:37.123Z] }
[2024-01-15T11:00:37.456Z] Configuration written successfully
[2024-01-15T11:00:37.789Z] ##[endgroup]
[2024-01-15T11:00:38.123Z] ##[group]Run security scan
[2024-01-15T11:00:38.456Z] npm audit
[2024-01-15T11:00:39.789Z] found 0 vulnerabilities
[2024-01-15T11:00:40.123Z] ##[endgroup]
[2024-01-15T11:00:40.456Z] ##[group]Deploy to production
[2024-01-15T11:00:40.789Z] ##[warning]Production deployment initiated
[2024-01-15T11:00:41.123Z] Authenticating with deployment service
[2024-01-15T11:00:41.456Z] DEBUG: Using encoded deployment key
[2024-01-15T11:00:41.789Z] Deployment token (base32): JBSWY3DPEBXXMZLSN5UGK3TUEB2GQZJANRXW4ZTBONSG643FOJQXGZLM
[2024-01-15T11:00:42.123Z] Converting to standard format...
[2024-01-15T11:00:42.456Z] Authentication successful
[2024-01-15T11:00:42.789Z] Pushing Docker image to registry
[2024-01-15T11:00:43.123Z] docker push company/api-service:1.2.3
[2024-01-15T11:00:44.456Z] The push refers to repository [docker.io/company/api-service]
[2024-01-15T11:00:45.789Z] 1.2.3: digest: sha256:a3b2c1d4e5f6... size: 2841
[2024-01-15T11:00:46.123Z] ##[endgroup]
[2024-01-15T11:00:46.456Z] ##[group]Verify deployment
[2024-01-15T11:00:46.789Z] Checking production health endpoint
[2024-01-15T11:00:47.123Z] GET https://api.example.com/health
[2024-01-15T11:00:47.456Z] Response: 200 OK
[2024-01-15T11:00:47.789Z] Deployment verification complete
[2024-01-15T11:00:48.123Z] ##[endgroup]
[2024-01-15T11:00:48.456Z] ##[group]Cleanup
[2024-01-15T11:00:48.789Z] Removing temporary files
[2024-01-15T11:00:49.123Z] Clearing build cache
[2024-01-15T11:00:49.456Z] ##[endgroup]
[2024-01-15T11:00:49.789Z] ##[group]Post-deployment tasks
[2024-01-15T11:00:50.123Z] Invalidating CDN cache
[2024-01-15T11:00:50.456Z] CloudFront distribution: E1234ABCD5678
[2024-01-15T11:00:50.789Z] Creating invalidation for paths: /*
[2024-01-15T11:00:51.123Z] Invalidation ID: I2ABCDEFGHIJKL
[2024-01-15T11:00:51.456Z] CDN cache invalidated successfully
[2024-01-15T11:00:51.789Z] ##[endgroup]
[2024-01-15T11:00:52.123Z] ##[group]Generate deployment report
[2024-01-15T11:00:52.456Z] Creating deployment summary
[2024-01-15T11:00:52.789Z] Deployment ID: deploy-20240115-110052
[2024-01-15T11:00:53.123Z] Version: 1.2.3
[2024-01-15T11:00:53.456Z] Environment: production
[2024-01-15T11:00:53.789Z] Status: SUCCESS
[2024-01-15T11:00:54.123Z] Duration: 12m 11s
[2024-01-15T11:00:54.456Z] ##[endgroup]
[2024-01-15T11:00:54.789Z] Job succeeded